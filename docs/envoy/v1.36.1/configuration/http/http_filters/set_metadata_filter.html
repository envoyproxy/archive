

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Set Metadata &mdash; envoy tag-v1.36.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=d7d10ef0" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/envoy.css?v=3ec0219e" />
      <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css?v=4da122e5" />

  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=0a5a9fed"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../../_static/copybutton.js?v=db7b0edf"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Stateful session" href="stateful_session_filter.html" />
    <link rel="prev" title="Set-Filter-State HTTP Filter" href="set_filter_state.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html">
            
              <img src="../../../_static/envoy-logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../about_docs.html">About the documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../intro/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../start/start.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../configuration.html">Configuration reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../overview/overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../listeners/listeners.html">Listeners</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../http.html">HTTP</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../http_conn_man/http_conn_man.html">HTTP connection manager</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="http_filters.html">HTTP filters</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="adaptive_concurrency_filter.html">Adaptive Concurrency</a></li>
<li class="toctree-l4"><a class="reference internal" href="admission_control_filter.html">Admission Control</a></li>
<li class="toctree-l4"><a class="reference internal" href="aws_lambda_filter.html">AWS Lambda</a></li>
<li class="toctree-l4"><a class="reference internal" href="api_key_auth_filter.html">API key auth</a></li>
<li class="toctree-l4"><a class="reference internal" href="aws_request_signing_filter.html">AWS Request Signing</a></li>
<li class="toctree-l4"><a class="reference internal" href="bandwidth_limit_filter.html">Bandwidth limit</a></li>
<li class="toctree-l4"><a class="reference internal" href="basic_auth_filter.html">Basic Auth</a></li>
<li class="toctree-l4"><a class="reference internal" href="buffer_filter.html">Buffer</a></li>
<li class="toctree-l4"><a class="reference internal" href="cache_filter.html">Cache filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="cache_v2_filter.html">CacheV2 filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="cdn_loop_filter.html">CDN-Loop header</a></li>
<li class="toctree-l4"><a class="reference internal" href="checksum_filter.html">Checksum</a></li>
<li class="toctree-l4"><a class="reference internal" href="compressor_filter.html">Compressor</a></li>
<li class="toctree-l4"><a class="reference internal" href="composite_filter.html">Composite Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="connect_grpc_bridge_filter.html">Connect-gRPC Bridge</a></li>
<li class="toctree-l4"><a class="reference internal" href="cors_filter.html">CORS</a></li>
<li class="toctree-l4"><a class="reference internal" href="credential_injector_filter.html">Credential injector</a></li>
<li class="toctree-l4"><a class="reference internal" href="csrf_filter.html">CSRF</a></li>
<li class="toctree-l4"><a class="reference internal" href="custom_response_filter.html">Custom Response Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="decompressor_filter.html">Decompressor</a></li>
<li class="toctree-l4"><a class="reference internal" href="dynamic_forward_proxy_filter.html">Dynamic forward proxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="dynamodb_filter.html">DynamoDB</a></li>
<li class="toctree-l4"><a class="reference internal" href="ext_authz_filter.html">External Authorization</a></li>
<li class="toctree-l4"><a class="reference internal" href="ext_proc_filter.html">External Processing</a></li>
<li class="toctree-l4"><a class="reference internal" href="fault_filter.html">Fault Injection</a></li>
<li class="toctree-l4"><a class="reference internal" href="file_system_buffer_filter.html">File System Buffer</a></li>
<li class="toctree-l4"><a class="reference internal" href="gcp_authn_filter.html">GCP Authentication Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="geoip_filter.html">IP Geolocation Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="golang_filter.html">Golang</a></li>
<li class="toctree-l4"><a class="reference internal" href="grpc_field_extraction_filter.html">gRPC Field Extraction</a></li>
<li class="toctree-l4"><a class="reference internal" href="grpc_http1_bridge_filter.html">gRPC HTTP/1.1 bridge</a></li>
<li class="toctree-l4"><a class="reference internal" href="grpc_http1_reverse_bridge_filter.html">gRPC HTTP/1.1 reverse bridge</a></li>
<li class="toctree-l4"><a class="reference internal" href="grpc_json_reverse_transcoder_filter.html">gRPC-JSON reverse transcoder</a></li>
<li class="toctree-l4"><a class="reference internal" href="grpc_json_transcoder_filter.html">gRPC-JSON transcoder</a></li>
<li class="toctree-l4"><a class="reference internal" href="grpc_stats_filter.html">gRPC Statistics</a></li>
<li class="toctree-l4"><a class="reference internal" href="grpc_web_filter.html">gRPC-Web</a></li>
<li class="toctree-l4"><a class="reference internal" href="header_mutation_filter.html">Header Mutation</a></li>
<li class="toctree-l4"><a class="reference internal" href="health_check_filter.html">Health check</a></li>
<li class="toctree-l4"><a class="reference internal" href="header_to_metadata_filter.html">Envoy Header-To-Metadata Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="ip_tagging_filter.html">IP Tagging</a></li>
<li class="toctree-l4"><a class="reference internal" href="json_to_metadata_filter.html">Envoy Json-To-Metadata Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="jwt_authn_filter.html">JWT Authentication</a></li>
<li class="toctree-l4"><a class="reference internal" href="kill_request_filter.html">Kill Request</a></li>
<li class="toctree-l4"><a class="reference internal" href="language_filter.html">Language</a></li>
<li class="toctree-l4"><a class="reference internal" href="local_rate_limit_filter.html">Local rate limit</a></li>
<li class="toctree-l4"><a class="reference internal" href="lua_filter.html">Lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="mcp_filter.html">MCP</a></li>
<li class="toctree-l4"><a class="reference internal" href="oauth2_filter.html">OAuth2</a></li>
<li class="toctree-l4"><a class="reference internal" href="on_demand_updates_filter.html">On-demand VHDS, S/RDS and CDS Updates</a></li>
<li class="toctree-l4"><a class="reference internal" href="original_src_filter.html">Original Source</a></li>
<li class="toctree-l4"><a class="reference internal" href="proto_message_extraction_filter.html">Proto Message Extraction</a></li>
<li class="toctree-l4"><a class="reference internal" href="rate_limit_filter.html">Rate limit</a></li>
<li class="toctree-l4"><a class="reference internal" href="rate_limit_quota_filter.html">Rate Limit Quota (Work-In-Progress)</a></li>
<li class="toctree-l4"><a class="reference internal" href="rbac_filter.html">Role Based Access Control (RBAC) Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="router_filter.html">Router</a></li>
<li class="toctree-l4"><a class="reference internal" href="set_filter_state.html">Set-Filter-State HTTP Filter</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Set Metadata</a></li>
<li class="toctree-l4"><a class="reference internal" href="stateful_session_filter.html">Stateful session</a></li>
<li class="toctree-l4"><a class="reference internal" href="sxg_filter.html">SXG</a></li>
<li class="toctree-l4"><a class="reference internal" href="tap_filter.html">Tap</a></li>
<li class="toctree-l4"><a class="reference internal" href="thrift_to_metadata_filter.html">Envoy Thrift-To-Metadata Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="upstream_codec_filter.html">Upstream Codec</a></li>
<li class="toctree-l4"><a class="reference internal" href="wasm_filter.html">Wasm</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../caches/caches.html">HTTP caches</a></li>
<li class="toctree-l3"><a class="reference internal" href="../caches_v2/caches.html">HTTP caches</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cluster_specifier/cluster_specifier.html">HTTP cluster specifier</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tcp_bridge/tcp_bridge.html">HTTP TCP bridge</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../upstream/upstream.html">Upstream clusters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../observability/observability.html">Observability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../security/security.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../operations/operations.html">Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../other_features/other_features.html">Other features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../other_protocols/other_protocols.html">Other protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../advanced/advanced.html">Advanced</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../best_practices/best_practices.html">Configuration best practices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../operations/operations.html">Operations and administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../extending/extending.html">Extending Envoy for custom use cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq/overview.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../version_history/version_history.html">Version history</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">envoy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../configuration.html">Configuration reference</a></li>
          <li class="breadcrumb-item"><a href="../http.html">HTTP</a></li>
          <li class="breadcrumb-item"><a href="http_filters.html">HTTP filters</a></li>
      <li class="breadcrumb-item active">Set Metadata</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/configuration/http/http_filters/set_metadata_filter.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="set-metadata">
<span id="config-http-filters-set-metadata"></span><h1>Set Metadata<a class="headerlink" href="#set-metadata" title="Link to this heading"></a></h1>
<ul class="simple">
<li><p>This filter should be configured with the type URL <code class="docutils literal notranslate"><span class="pre">type.googleapis.com/envoy.extensions.filters.http.set_metadata.v3.Config</span></code>.</p></li>
<li><p><a class="reference internal" href="../../../api-v3/extensions/filters/http/set_metadata/v3/set_metadata.proto.html#envoy-v3-api-msg-extensions-filters-http-set-metadata-v3-config"><span class="std std-ref">v3 API reference</span></a></p></li>
</ul>
<p>The Set Metadata filter adds or updates dynamic metadata with static or dynamically formatted data.
This filter is useful for attaching contextual information to requests that can be consumed by other
filters, used for load balancing decisions, included in access logs, or utilized for routing decisions.</p>
<p>The filter supports both untyped metadata (using <code class="docutils literal notranslate"><span class="pre">google.protobuf.Struct</span></code>) and typed metadata
(using <code class="docutils literal notranslate"><span class="pre">google.protobuf.Any</span></code>). Dynamic metadata values are updated according to specific merge
rules that vary based on the value type and the <code class="docutils literal notranslate"><span class="pre">allow_overwrite</span></code> configuration.</p>
<p>Common use cases include:</p>
<ul class="simple">
<li><p>Tagging requests with environment or service information for downstream processing.</p></li>
<li><p>Adding routing hints for load balancer subset selection.</p></li>
<li><p>Enriching access logs with additional context.</p></li>
<li><p>Storing computed values for use by subsequent filters in the chain.</p></li>
</ul>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Link to this heading"></a></h2>
<p>The filter can be configured with multiple metadata entries, each targeting a specific namespace.
Each entry can contain either static values or use the deprecated legacy configuration format.</p>
</section>
<section id="metadata-merge-rules">
<h2>Metadata Merge Rules<a class="headerlink" href="#metadata-merge-rules" title="Link to this heading"></a></h2>
<p>Dynamic metadata values are updated with the following rules. If a key does not exist, it is copied into the current metadata. If the key exists, the following rules apply:</p>
<ul class="simple">
<li><p><strong>Typed metadata values</strong>: When <a class="reference internal" href="../../../api-v3/extensions/filters/http/set_metadata/v3/set_metadata.proto.html#envoy-v3-api-field-extensions-filters-http-set-metadata-v3-metadata-typed-value"><span class="std std-ref">typed_value</span></a> is used, it will overwrite existing values if and only if <a class="reference internal" href="../../../api-v3/extensions/filters/http/set_metadata/v3/set_metadata.proto.html#envoy-v3-api-field-extensions-filters-http-set-metadata-v3-metadata-allow-overwrite"><span class="std std-ref">allow_overwrite</span></a> is set to <code class="docutils literal notranslate"><span class="pre">true</span></code>. Otherwise, the operation is skipped.</p></li>
<li><p><strong>Untyped metadata values</strong>: When <a class="reference internal" href="../../../api-v3/extensions/filters/http/set_metadata/v3/set_metadata.proto.html#envoy-v3-api-field-extensions-filters-http-set-metadata-v3-metadata-value"><span class="std std-ref">value</span></a> is used and <code class="docutils literal notranslate"><span class="pre">allow_overwrite</span></code> is set to <code class="docutils literal notranslate"><span class="pre">true</span></code>, or when the deprecated <a class="reference internal" href="../../../api-v3/extensions/filters/http/set_metadata/v3/set_metadata.proto.html#envoy-v3-api-field-extensions-filters-http-set-metadata-v3-config-value"><span class="std std-ref">value</span></a> field is used, values are merged using the following scheme:</p>
<ul>
<li><p><strong>Different type values</strong>: The existing value is replaced entirely.</p></li>
<li><p><strong>Scalar values</strong> (null, string, number, boolean): The existing value is replaced.</p></li>
<li><p><strong>Lists</strong>: New values are appended to the existing list.</p></li>
<li><p><strong>Structures</strong>: The merge rules are applied recursively to nested structures.</p></li>
</ul>
</li>
</ul>
<section id="merge-example">
<h3>Merge Example<a class="headerlink" href="#merge-example" title="Link to this heading"></a></h3>
<p>For instance, if the namespace already contains this structure:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">myint</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="nt">mylist</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;a&quot;</span><span class="p p-Indicator">]</span>
<span class="nt">mykey</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;val&quot;</span><span class="p p-Indicator">]</span>
<span class="nt">mytags</span><span class="p">:</span>
<span class="w">  </span><span class="nt">tag0</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</pre></div>
</div>
<p>and the value to set is:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">myint</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="nt">mylist</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;b&quot;</span><span class="p p-Indicator">,</span><span class="s">&quot;c&quot;</span><span class="p p-Indicator">]</span>
<span class="nt">mykey</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="nt">mytags</span><span class="p">:</span>
<span class="w">  </span><span class="nt">tag1</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</pre></div>
</div>
<p>After applying this filter, the namespace will contain:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">myint</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="nt">mylist</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;a&quot;</span><span class="p p-Indicator">,</span><span class="s">&quot;b&quot;</span><span class="p p-Indicator">,</span><span class="s">&quot;c&quot;</span><span class="p p-Indicator">]</span>
<span class="nt">mykey</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="nt">mytags</span><span class="p">:</span>
<span class="w">  </span><span class="nt">tag0</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">tag1</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</pre></div>
</div>
</section>
</section>
<section id="configuration-examples">
<h2>Configuration Examples<a class="headerlink" href="#configuration-examples" title="Link to this heading"></a></h2>
<section id="basic-static-metadata">
<h3>Basic Static Metadata<a class="headerlink" href="#basic-static-metadata" title="Link to this heading"></a></h3>
<p>A simple configuration that adds static metadata to the <code class="docutils literal notranslate"><span class="pre">envoy.lb</span></code> namespace:</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../../../_downloads/19eb2434e478168acbb92b880d518f25/set-metadata-basic-static.yaml"><code class="xref download docutils literal notranslate"><span class="pre">set-metadata-basic-static.yaml</span></code></a></span><a class="headerlink" href="#id1" title="Link to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos">29</span><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">envoy.filters.http.set_metadata</span>
<span class="linenos">30</span><span class="w">            </span><span class="nt">typed_config</span><span class="p">:</span>
<span class="linenos">31</span><span class="w">              </span><span class="s">&quot;@type&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.extensions.filters.http.set_metadata.v3.Config</span>
<span class="linenos">32</span><span class="w">              </span><span class="nt">metadata</span><span class="p">:</span>
<span class="linenos">33</span><span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">metadata_namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">envoy.lb</span>
<span class="linenos">34</span><span class="w">                </span><span class="nt">value</span><span class="p">:</span>
<span class="linenos">35</span><span class="w">                  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;v1.2.3&quot;</span>
<span class="linenos">36</span><span class="w">                  </span><span class="nt">environment</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;production&quot;</span>
<span class="linenos">37</span><span class="w">                  </span><span class="nt">features</span><span class="p">:</span>
<span class="linenos">38</span><span class="w">                  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;feature_a&quot;</span>
<span class="linenos">39</span><span class="w">                  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;feature_b&quot;</span>
</pre></div>
</div>
</div>
</section>
<section id="multiple-metadata-entries">
<h3>Multiple Metadata Entries<a class="headerlink" href="#multiple-metadata-entries" title="Link to this heading"></a></h3>
<p>Configuration with multiple metadata entries targeting different namespaces:</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../../../_downloads/66759362868ed5b2b9d8a03f58058a4d/set-metadata-multiple-entries.yaml"><code class="xref download docutils literal notranslate"><span class="pre">set-metadata-multiple-entries.yaml</span></code></a></span><a class="headerlink" href="#id2" title="Link to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos">29</span><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">envoy.filters.http.set_metadata</span>
<span class="linenos">30</span><span class="w">            </span><span class="nt">typed_config</span><span class="p">:</span>
<span class="linenos">31</span><span class="w">              </span><span class="s">&quot;@type&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.extensions.filters.http.set_metadata.v3.Config</span>
<span class="linenos">32</span><span class="w">              </span><span class="nt">metadata</span><span class="p">:</span>
<span class="linenos">33</span><span class="w">              </span><span class="c1"># Service identification metadata</span>
<span class="linenos">34</span><span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">metadata_namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">envoy.lb</span>
<span class="linenos">35</span><span class="w">                </span><span class="nt">allow_overwrite</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="linenos">36</span><span class="w">                </span><span class="nt">value</span><span class="p">:</span>
<span class="linenos">37</span><span class="w">                  </span><span class="nt">service</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;user-service&quot;</span>
<span class="linenos">38</span><span class="w">                  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;v2.1.0&quot;</span>
<span class="linenos">39</span><span class="w">              </span><span class="c1"># Request routing metadata</span>
<span class="linenos">40</span><span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">metadata_namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">envoy.filters.http.fault</span>
<span class="linenos">41</span><span class="w">                </span><span class="nt">allow_overwrite</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="linenos">42</span><span class="w">                </span><span class="nt">value</span><span class="p">:</span>
<span class="linenos">43</span><span class="w">                  </span><span class="nt">upstream_cluster</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;backend&quot;</span>
<span class="linenos">44</span><span class="w">                  </span><span class="nt">retry_policy</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;aggressive&quot;</span>
</pre></div>
</div>
</div>
</section>
<section id="typed-metadata-configuration">
<h3>Typed Metadata Configuration<a class="headerlink" href="#typed-metadata-configuration" title="Link to this heading"></a></h3>
<p>Configuration using typed metadata with <code class="docutils literal notranslate"><span class="pre">google.protobuf.Any</span></code>:</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../../../_downloads/83ae57957fb874e78ab85ee85e4b2916/set-metadata-typed-configuration.yaml"><code class="xref download docutils literal notranslate"><span class="pre">set-metadata-typed-configuration.yaml</span></code></a></span><a class="headerlink" href="#id3" title="Link to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos">29</span><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">envoy.filters.http.set_metadata</span>
<span class="linenos">30</span><span class="w">            </span><span class="nt">typed_config</span><span class="p">:</span>
<span class="linenos">31</span><span class="w">              </span><span class="s">&quot;@type&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.extensions.filters.http.set_metadata.v3.Config</span>
<span class="linenos">32</span><span class="w">              </span><span class="nt">metadata</span><span class="p">:</span>
<span class="linenos">33</span><span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">metadata_namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">custom.typed</span>
<span class="linenos">34</span><span class="w">                </span><span class="nt">allow_overwrite</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="linenos">35</span><span class="w">                </span><span class="nt">typed_value</span><span class="p">:</span>
<span class="linenos">36</span><span class="w">                  </span><span class="s">&quot;@type&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.extensions.filters.http.set_metadata.v3.Config</span>
<span class="linenos">37</span><span class="w">                  </span><span class="nt">metadata_namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nested_namespace</span>
<span class="linenos">38</span><span class="w">                  </span><span class="nt">value</span><span class="p">:</span>
<span class="linenos">39</span><span class="w">                    </span><span class="nt">custom_field</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;typed_value&quot;</span>
</pre></div>
</div>
</div>
</section>
<section id="overwrite-control">
<h3>Overwrite Control<a class="headerlink" href="#overwrite-control" title="Link to this heading"></a></h3>
<p>Configuration demonstrating overwrite control behavior:</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../../../_downloads/d27126169cf0287eef88b35052488b39/set-metadata-overwrite-control.yaml"><code class="xref download docutils literal notranslate"><span class="pre">set-metadata-overwrite-control.yaml</span></code></a></span><a class="headerlink" href="#id4" title="Link to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos">29</span><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">envoy.filters.http.set_metadata</span>
<span class="linenos">30</span><span class="w">            </span><span class="nt">typed_config</span><span class="p">:</span>
<span class="linenos">31</span><span class="w">              </span><span class="s">&quot;@type&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.extensions.filters.http.set_metadata.v3.Config</span>
<span class="linenos">32</span><span class="w">              </span><span class="nt">metadata</span><span class="p">:</span>
<span class="linenos">33</span><span class="w">              </span><span class="c1"># First entry - will be set initially</span>
<span class="linenos">34</span><span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">metadata_namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test.namespace</span>
<span class="linenos">35</span><span class="w">                </span><span class="nt">value</span><span class="p">:</span>
<span class="linenos">36</span><span class="w">                  </span><span class="nt">counter</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="linenos">37</span><span class="w">                  </span><span class="nt">list</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;first&quot;</span><span class="p p-Indicator">]</span>
<span class="linenos">38</span><span class="w">              </span><span class="c1"># Second entry - will be ignored without allow_overwrite</span>
<span class="linenos">39</span><span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">metadata_namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test.namespace</span>
<span class="linenos">40</span><span class="w">                </span><span class="nt">value</span><span class="p">:</span>
<span class="linenos">41</span><span class="w">                  </span><span class="nt">counter</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="linenos">42</span><span class="w">                  </span><span class="nt">list</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;second&quot;</span><span class="p p-Indicator">]</span>
<span class="linenos">43</span><span class="w">              </span><span class="c1"># Third entry - will merge with allow_overwrite: true</span>
<span class="linenos">44</span><span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">metadata_namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test.namespace</span>
<span class="linenos">45</span><span class="w">                </span><span class="nt">allow_overwrite</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="linenos">46</span><span class="w">                </span><span class="nt">value</span><span class="p">:</span>
<span class="linenos">47</span><span class="w">                  </span><span class="nt">counter</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="linenos">48</span><span class="w">                  </span><span class="nt">list</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;third&quot;</span><span class="p p-Indicator">]</span>
<span class="linenos">49</span><span class="w">                  </span><span class="nt">new_field</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;added&quot;</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In the above example, the final metadata will contain:
<code class="docutils literal notranslate"><span class="pre">counter:</span> <span class="pre">3</span></code>, <code class="docutils literal notranslate"><span class="pre">list:</span> <span class="pre">[&quot;first&quot;,</span> <span class="pre">&quot;third&quot;]</span></code>, and <code class="docutils literal notranslate"><span class="pre">new_field:</span> <span class="pre">&quot;added&quot;</span></code>.
The second entry is ignored because <code class="docutils literal notranslate"><span class="pre">allow_overwrite</span></code> is not set.</p>
</div>
</section>
</section>
<section id="statistics">
<h2>Statistics<a class="headerlink" href="#statistics" title="Link to this heading"></a></h2>
<p>The Set Metadata filter outputs statistics in the <code class="docutils literal notranslate"><span class="pre">http.&lt;stat_prefix&gt;.set_metadata.</span></code> namespace.
The <a class="reference internal" href="../../../api-v3/extensions/filters/network/http_connection_manager/v3/http_connection_manager.proto.html#envoy-v3-api-field-extensions-filters-network-http-connection-manager-v3-httpconnectionmanager-stat-prefix"><span class="std std-ref">stat prefix</span></a>
comes from the owning HTTP connection manager.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 25.0%" />
<col style="width: 25.0%" />
<col style="width: 50.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>overwrite_denied</p></td>
<td><p>Counter</p></td>
<td><p>Total number of denied attempts to overwrite an existing metadata value when <code class="docutils literal notranslate"><span class="pre">allow_overwrite</span></code> is <code class="docutils literal notranslate"><span class="pre">false</span></code></p></td>
</tr>
</tbody>
</table>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="set_filter_state.html" class="btn btn-neutral float-left" title="Set-Filter-State HTTP Filter" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="stateful_session_filter.html" class="btn btn-neutral float-right" title="Stateful session" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2025, Envoy Project Authors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>