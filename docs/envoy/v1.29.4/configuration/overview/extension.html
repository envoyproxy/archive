<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Extension configuration &mdash; envoy tag-v1.29.4 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=d7d10ef0" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/envoy.css?v=3ec0219e" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=4da122e5" />

  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=2c734243"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
        <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../_static/copybutton.js?v=db7b0edf"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="xDS API endpoints" href="xds_api.html" />
    <link rel="prev" title="Examples" href="examples.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html">
            
              <img src="../../_static/envoy-logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                tag-v1.29.4
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../about_docs.html">About the documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../intro/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../start/start.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../configuration.html">Configuration reference</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="overview.html">Overview</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="versioning.html">Versioning</a></li>
<li class="toctree-l3"><a class="reference internal" href="bootstrap.html">Bootstrap configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Extension configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#discovery-service">Discovery service</a></li>
<li class="toctree-l4"><a class="reference internal" href="#listener-filters">Listener filters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#network-filters">Network filters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#http-filters">HTTP filters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#statistics">Statistics</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="xds_api.html">xDS API endpoints</a></li>
<li class="toctree-l3"><a class="reference internal" href="mgmt_server.html">Management Server</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../listeners/listeners.html">Listeners</a></li>
<li class="toctree-l2"><a class="reference internal" href="../http/http.html">HTTP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upstream/upstream.html">Upstream clusters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/observability.html">Observability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security/security.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../operations/operations.html">Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../other_features/other_features.html">Other features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../other_protocols/other_protocols.html">Other protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced/advanced.html">Advanced</a></li>
<li class="toctree-l2"><a class="reference internal" href="../best_practices/best_practices.html">Configuration best practices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../operations/operations.html">Operations and administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../extending/extending.html">Extending Envoy for custom use cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/overview.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../version_history/version_history.html">Version history</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">envoy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../configuration.html">Configuration reference</a></li>
          <li class="breadcrumb-item"><a href="overview.html">Overview</a></li>
      <li class="breadcrumb-item active">Extension configuration</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/configuration/overview/extension.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="extension-configuration">
<span id="config-overview-extension-configuration"></span><h1>Extension configuration<a class="headerlink" href="#extension-configuration" title="Permalink to this heading"></a></h1>
<p>Each configuration resource in Envoy has a type URL in the <code class="docutils literal notranslate"><span class="pre">typed_config</span></code>. This
type corresponds to a versioned schema. The type URL uniquely identifies an
extension capable of interpreting the configuration. The <code class="docutils literal notranslate"><span class="pre">name</span></code> field is
optional and can be used as an identifier or as an annotation for the
particular instance of the extension configuration. For example, the following
filter configuration snippet is permitted:</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../../_downloads/ac3ae5813f57c25e5c3e533fa5f48ade/without-type-url.yaml"><code class="xref download docutils literal notranslate"><span class="pre">extensions-demo.yaml</span></code></a></span><a class="headerlink" href="#id1" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos">14</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">front-http-proxy</span>
<span class="linenos">15</span><span class="w">        </span><span class="nt">typed_config</span><span class="p">:</span>
<span class="linenos">16</span><span class="w">          </span><span class="s">&quot;@type&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager</span>
<span class="linenos">17</span><span class="w">          </span><span class="nt">stat_prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress_http</span>
<span class="linenos">18</span><span class="w">          </span><span class="nt">codec_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AUTO</span>
<span class="linenos">19</span><span class="w">          </span><span class="nt">rds</span><span class="p">:</span>
<span class="linenos">20</span><span class="w">            </span><span class="nt">route_config_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local_route</span>
<span class="linenos">21</span><span class="w">            </span><span class="nt">config_source</span><span class="p">:</span>
<span class="linenos">22</span><span class="w">              </span><span class="nt">resource_api_version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">V3</span>
<span class="linenos">23</span><span class="w">              </span><span class="nt">api_config_source</span><span class="p">:</span>
<span class="linenos">24</span><span class="w">                </span><span class="nt">api_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GRPC</span>
<span class="linenos">25</span><span class="w">                </span><span class="nt">transport_api_version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">V3</span>
<span class="linenos">26</span><span class="w">                </span><span class="nt">grpc_services</span><span class="p">:</span>
<span class="linenos">27</span><span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">envoy_grpc</span><span class="p">:</span>
<span class="linenos">28</span><span class="w">                    </span><span class="nt">cluster_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">xds_cluster</span>
<span class="linenos">29</span><span class="w">          </span><span class="nt">http_filters</span><span class="p">:</span>
<span class="linenos">30</span><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">front-router</span>
<span class="linenos">31</span><span class="w">            </span><span class="nt">typed_config</span><span class="p">:</span>
<span class="linenos">32</span><span class="w">              </span><span class="s">&quot;@type&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.extensions.filters.http.router.v3.Router</span>
<span class="linenos">33</span><span class="w">              </span><span class="nt">dynamic_stats</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>
</div>
</div>
<p>In case the control plane lacks the schema definitions for an extension,
<code class="docutils literal notranslate"><span class="pre">xds.type.v3.TypedStruct</span></code> should be used as a generic container. The type URL
inside it is then used by a client to convert the contents to a typed
configuration resource. For example, the above example could be written as
follows:</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../../_downloads/fbefb262e87dc4d3752545072e3d7b26/with-type-url.yaml"><code class="xref download docutils literal notranslate"><span class="pre">extensions-demo-with-type-url.yaml</span></code></a></span><a class="headerlink" href="#id2" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos">14</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">front-http-proxy</span>
<span class="linenos">15</span><span class="w">        </span><span class="nt">typed_config</span><span class="p">:</span>
<span class="linenos">16</span><span class="w">          </span><span class="s">&quot;@type&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/xds.type.v3.TypedStruct</span>
<span class="linenos">17</span><span class="w">          </span><span class="nt">type_url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager</span>
<span class="linenos">18</span><span class="w">          </span><span class="nt">value</span><span class="p">:</span>
<span class="linenos">19</span><span class="w">            </span><span class="nt">stat_prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress_http</span>
<span class="linenos">20</span><span class="w">            </span><span class="nt">codec_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AUTO</span>
<span class="linenos">21</span><span class="w">            </span><span class="nt">rds</span><span class="p">:</span>
<span class="linenos">22</span><span class="w">              </span><span class="nt">route_config_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local_route</span>
<span class="linenos">23</span><span class="w">              </span><span class="nt">config_source</span><span class="p">:</span>
<span class="linenos">24</span><span class="w">                </span><span class="nt">resource_api_version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">V3</span>
<span class="linenos">25</span><span class="w">                </span><span class="nt">api_config_source</span><span class="p">:</span>
<span class="linenos">26</span><span class="w">                  </span><span class="nt">api_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GRPC</span>
<span class="linenos">27</span><span class="w">                  </span><span class="nt">transport_api_version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">V3</span>
<span class="linenos">28</span><span class="w">                  </span><span class="nt">grpc_services</span><span class="p">:</span>
<span class="linenos">29</span><span class="w">                  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">envoy_grpc</span><span class="p">:</span>
<span class="linenos">30</span><span class="w">                      </span><span class="nt">cluster_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">xds_cluster</span>
<span class="linenos">31</span><span class="w">            </span><span class="nt">http_filters</span><span class="p">:</span>
<span class="linenos">32</span><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">front-router</span>
<span class="linenos">33</span><span class="w">              </span><span class="nt">typed_config</span><span class="p">:</span>
<span class="linenos">34</span><span class="w">                </span><span class="s">&quot;@type&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/xds.type.v3.TypedStruct</span>
<span class="linenos">35</span><span class="w">                </span><span class="nt">type_url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.extensions.filters.http.router.v3.Router</span>
<span class="linenos">36</span><span class="w">                </span><span class="nt">value</span><span class="p">:</span>
<span class="linenos">37</span><span class="w">                  </span><span class="nt">dynamic_stats</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>
</div>
</div>
<section id="discovery-service">
<span id="config-overview-extension-discovery"></span><h2>Discovery service<a class="headerlink" href="#discovery-service" title="Permalink to this heading"></a></h2>
<p>Extension configuration can be supplied dynamically from an <a class="reference internal" href="../../api-docs/xds_protocol.html#xds-protocol"><span class="std std-ref">xDS
management server</span></a> using <a class="reference internal" href="../../api-v3/service/extension/v3/config_discovery.proto.html#envoy-v3-api-file-envoy-service-extension-v3-config-discovery-proto"><span class="std std-ref">ExtensionConfiguration discovery
service</span></a>.
The name field in the extension configuration acts as the resource identifier.</p>
</section>
<section id="listener-filters">
<h2>Listener filters<a class="headerlink" href="#listener-filters" title="Permalink to this heading"></a></h2>
<p>For Listener filters, the discovery service configuration is: <a class="reference internal" href="../../api-v3/config/listener/v3/listener_components.proto.html#envoy-v3-api-field-config-listener-v3-listenerfilter-config-discovery"><span class="std std-ref">dynamic listener filter
re-configuration</span></a>.
The dynamic listener filter config is only supported in TCP listeners.
If the dynamic configuration is missing, the connection will be rejected until a valid config is updated.</p>
</section>
<section id="network-filters">
<h2>Network filters<a class="headerlink" href="#network-filters" title="Permalink to this heading"></a></h2>
<p>For downstream network filters, the discovery service configuration is: <a class="reference internal" href="../../api-v3/config/listener/v3/listener_components.proto.html#envoy-v3-api-field-config-listener-v3-filter-config-discovery"><span class="std std-ref">dynamic filter
re-configuration</span></a>.
If the dynamic configuration is missing, the connection will be rejected until a valid config is updated.
When a filter configuration updates, the new configuration will only apply to new connections, existing connections
will keep using the older filter configuration.</p>
</section>
<section id="http-filters">
<h2>HTTP filters<a class="headerlink" href="#http-filters" title="Permalink to this heading"></a></h2>
<p>For HTTP filters, HTTP connection manager supports <a class="reference internal" href="../../api-v3/extensions/filters/network/http_connection_manager/v3/http_connection_manager.proto.html#envoy-v3-api-field-extensions-filters-network-http-connection-manager-v3-httpfilter-config-discovery"><span class="std std-ref">dynamic filter
re-configuration</span></a>.
If the configuration is missing a local HTTP response with ‘500’ status code will be returned.</p>
</section>
<section id="statistics">
<h2>Statistics<a class="headerlink" href="#statistics" title="Permalink to this heading"></a></h2>
<p>In addition to the <a class="reference internal" href="mgmt_server.html#subscription-statistics"><span class="std std-ref">statistics</span></a> supported for xDS subscriptions, the following statistics
are supported for listener filters, downstream network filters, and HTTP filters, rooted at <em>extension_config_discovery.&lt;stat_prefix&gt;.&lt;extension_config_name&gt;</em>.</p>
<ul class="simple">
<li><p>For TCP listener filters, the value of <em>&lt;stat_prefix&gt;</em> is <em>tcp_listener_filter</em>.</p></li>
<li><p>For downstream network filters, the value of <em>&lt;stat_prefix&gt;</em> is <em>network_filter</em>.</p></li>
<li><p>For upstream network filters, the value of <em>&lt;stat_prefix&gt;</em> is <em>upstream_network_filter</em>.</p></li>
<li><p>For downstream HTTP filters, the value of <em>&lt;stat_prefix&gt;</em> is <em>http_filter</em>.</p></li>
<li><p>For upstream HTTP filters, the value of <em>&lt;stat_prefix&gt;</em> is <em>upstream_http_filter</em>.</p></li>
</ul>
<table class="docutils align-default">
<colgroup>
<col style="width: 25.0%" />
<col style="width: 25.0%" />
<col style="width: 50.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>config_reload</p></td>
<td><p>Counter</p></td>
<td><p>Total number of successful configuration updates</p></td>
</tr>
<tr class="row-odd"><td><p>config_fail</p></td>
<td><p>Counter</p></td>
<td><p>Total number of failed configuration updates</p></td>
</tr>
<tr class="row-even"><td><p>config_conflict</p></td>
<td><p>Counter</p></td>
<td><p>Total number of conflicting applications of configuration updates; this may happen when a new listener cannot reuse a subscribed extension configuration due to an invalid type URL.</p></td>
</tr>
</tbody>
</table>
<p>Additionally, the following statistics are supported to indicate that a connection was closed due to a missing
configuration, rooted at listener.&lt;address&gt; (or listener.&lt;stat_prefix&gt;. if stat_prefix is non-empty).</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 25.0%" />
<col style="width: 25.0%" />
<col style="width: 50.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>extension_config_missing</p></td>
<td><p>Counter</p></td>
<td><p>Total connections closed due to missing listener filter extension configuration</p></td>
</tr>
<tr class="row-odd"><td><p>network_extension_config_missing</p></td>
<td><p>Counter</p></td>
<td><p>Total connections closed due to missing network filter extension configuration</p></td>
</tr>
</tbody>
</table>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="examples.html" class="btn btn-neutral float-left" title="Examples" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="xds_api.html" class="btn btn-neutral float-right" title="xDS API endpoints" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2024, Envoy Project Authors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>