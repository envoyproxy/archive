

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Client-Side Weighted Round Robin Load Balancing Policy (proto) &mdash; envoy tag-v1.33.9 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css?v=d7d10ef0" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/css/envoy.css?v=3ec0219e" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/tabs.css?v=4da122e5" />

  
    <link rel="shortcut icon" href="../../../../../_static/favicon.ico"/>
      <script src="../../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../../_static/documentation_options.js?v=4438c99e"></script>
      <script src="../../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../../../../_static/copybutton.js?v=db7b0edf"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <link rel="next" title="Cluster Provided Load Balancing Policy (proto)" href="../../cluster_provided/v3/cluster_provided.proto.html" />
    <link rel="prev" title="Load balancing policies" href="../../../../config/load_balancing_policies/load_balancing_policies.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../index.html">
            
              <img src="../../../../../_static/envoy-logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../../about_docs.html">About the documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../intro/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../start/start.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../configuration/configuration.html">Configuration reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../operations/operations.html">Operations and administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../extending/extending.html">Extending Envoy for custom use cases</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../../../api/api.html">API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../../../api/api_supported_versions.html">Supported API versions</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../../api.html">v3 API reference</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../../../bootstrap/bootstrap.html">Bootstrap</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../listeners/listeners.html">Listeners</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../clusters/clusters.html">Clusters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../http_routes/http_routes.html">HTTP route management</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../../../../config/config.html">Extensions</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../../../../config/accesslog/filters.html">Access log extension filters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../config/formatter/formatter.html">Access log formatters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../config/accesslog/accesslog.html">Access loggers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../config/cluster/cluster.html">Cluster</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../config/common/common.html">Common</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../config/compression/compression.html">Compression</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../config/config_validators/config_validators.html">Config validators</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../config/contrib/contrib.html">Contrib extensions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../config/dns_resolver/dns_resolver.html">DNS resolver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../config/endpoint/endpoint.html">Endpoint</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../config/filter/filter.html">Filters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../config/grpc_credential/grpc_credential.html">Grpc credentials</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../config/health_check_event_sinks/health_check_event_sinks.html">Health check event sinks</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../config/health_checker/health_checker.html">Health checkers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../config/http/early_header_mutation.html">HTTP early header mutation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../config/http/custom_response.html">Custom response policies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../config/http/header_formatters.html">HTTP header formatters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../config/http/header_validators.html">HTTP header validators</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../config/http/original_ip_detection.html">HTTP original IP detection</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../config/http/stateful_session.html">HTTP stateful session</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../config/injected_credentials/injected_credentials.html">Injected credentials</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../config/geoip_provider/geoip_provider.html">Geolocation providers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../config/trace/trace.html">HTTP tracers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../config/internal_redirect/internal_redirect.html">Internal redirect predicates</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../config/path/match/path_matcher.html">Path matcher</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../config/path/rewrite/path_rewriter.html">Path rewriter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../config/quic/quic_extensions.html">Quic extensions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../config/descriptors/descriptors.html">Rate limit descriptors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../config/rbac/rbac.html">RBAC</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../config/rbac/matchers.html">RBAC matchers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../config/request_id/request_id.html">Request ID</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../config/resource_monitor/resource_monitor.html">Resource monitors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../config/retry/retry.html">Retry predicates</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../config/stat_sinks/stat_sinks.html">Stat sinks</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../config/string_matcher/string_matcher.html">String Matcher</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../config/transport_socket/transport_socket.html">Transport sockets</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../config/upstream/upstream.html">Upstream configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../config/wasm/wasm.html">WASM</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../config/watchdog/watchdog.html">Watchdog</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="../../../../config/load_balancing_policies/load_balancing_policies.html">Load balancing policies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../config/cluster_specifier/cluster_specifier.html">Cluster specifier</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../admin/admin.html">Admin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../data/data.html">Envoy data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../service/service.html">Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../common_messages/common_messages.html">Common messages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../common_messages/common_messages_xds.html">Common messages (XDS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../types/types.html">Types</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../api-docs/xds_protocol.html">xDS REST and gRPC protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../api/client_features.html">Well Known Client Features</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../faq/overview.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../version_history/version_history.html">Version history</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">envoy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../../../api/api.html">API</a></li>
          <li class="breadcrumb-item"><a href="../../../../api.html">v3 API reference</a></li>
          <li class="breadcrumb-item"><a href="../../../../config/config.html">Extensions</a></li>
          <li class="breadcrumb-item"><a href="../../../../config/load_balancing_policies/load_balancing_policies.html">Load balancing policies</a></li>
      <li class="breadcrumb-item active">Client-Side Weighted Round Robin Load Balancing Policy (proto)</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../_sources/api-v3/extensions/load_balancing_policies/client_side_weighted_round_robin/v3/client_side_weighted_round_robin.proto.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="client-side-weighted-round-robin-load-balancing-policy-proto">
<span id="envoy-v3-api-file-envoy-extensions-load-balancing-policies-client-side-weighted-round-robin-v3-client-side-weighted-round-robin-proto"></span><h1>Client-Side Weighted Round Robin Load Balancing Policy (proto)<a class="headerlink" href="#client-side-weighted-round-robin-load-balancing-policy-proto" title="Link to this heading"></a></h1>
<p id="extension-envoy-load-balancing-policies-client-side-weighted-round-robin">This extension has the qualified name <code class="docutils literal notranslate"><span class="pre">envoy.load_balancing_policies.client_side_weighted_round_robin</span></code></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This extension is work-in-progress. Functionality is incomplete and it is not intended for production use.</p>
<p>This extension has an unknown security posture and should only be
used in deployments where both the downstream and upstream are
trusted.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>This extension extends and can be used with the following extension category:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../../../config/cluster/v3/cluster.proto.html#extension-category-envoy-load-balancing-policies"><span class="std std-ref">envoy.load_balancing_policies</span></a></p></li>
</ul>
<p>This extension must be configured with one of the following type URLs:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#envoy-v3-api-msg-extensions-load-balancing-policies-client-side-weighted-round-robin-v3-clientsideweightedroundrobin"><span class="std std-ref">type.googleapis.com/envoy.extensions.load_balancing_policies.client_side_weighted_round_robin.v3.ClientSideWeightedRoundRobin</span></a></p></li>
</ul>
</div>
<section id="extensions-load-balancing-policies-client-side-weighted-round-robin-v3-clientsideweightedroundrobin">
<span id="envoy-v3-api-msg-extensions-load-balancing-policies-client-side-weighted-round-robin-v3-clientsideweightedroundrobin"></span><h2>extensions.load_balancing_policies.client_side_weighted_round_robin.v3.ClientSideWeightedRoundRobin<a class="headerlink" href="#extensions-load-balancing-policies-client-side-weighted-round-robin-v3-clientsideweightedroundrobin" title="Link to this heading"></a></h2>
<p><a class="extlink-repo reference external" href="https://github.com/envoyproxy/envoy/blob/v1.33.9/api/envoy/extensions/load_balancing_policies/client_side_weighted_round_robin/v3/client_side_weighted_round_robin.proto#L38">[extensions.load_balancing_policies.client_side_weighted_round_robin.v3.ClientSideWeightedRoundRobin proto]</a></p>
<p>Configuration for the client_side_weighted_round_robin LB policy.</p>
<p>This policy differs from the built-in ROUND_ROBIN policy in terms of
how the endpoint weights are determined. In the ROUND_ROBIN policy,
the endpoint weights are sent by the control plane via EDS. However,
in this policy, the endpoint weights are instead determined via qps (queries
per second), eps (errors per second), and utilization metrics sent by the
endpoint using the Open Request Cost Aggregation (ORCA) protocol. Utilization
is determined by using the ORCA application_utilization field, if set, or
else falling back to the cpu_utilization field. All queries count toward qps,
regardless of result. Only failed queries count toward eps. A config
parameter error_utilization_penalty controls the penalty to adjust endpoint
weights using eps and qps. The weight of a given endpoint is computed as:
<code class="docutils literal notranslate"><span class="pre">qps</span> <span class="pre">/</span> <span class="pre">(utilization</span> <span class="pre">+</span> <span class="pre">eps/qps</span> <span class="pre">*</span> <span class="pre">error_utilization_penalty)</span></code>.</p>
<p>See the <a class="reference internal" href="../../../../../intro/arch_overview/upstream/load_balancing/load_balancers.html#arch-overview-load-balancing-types"><span class="std std-ref">load balancing architecture
overview</span></a> for more information.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;enable_oob_load_report&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;oob_reporting_period&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;blackout_period&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;weight_expiration_period&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;weight_update_period&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;error_utilization_penalty&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;metric_names_for_computing_utilization&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="simple" id="envoy-v3-api-field-extensions-load-balancing-policies-client-side-weighted-round-robin-v3-clientsideweightedroundrobin-enable-oob-load-report">
<dt>enable_oob_load_report</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/reference/google.protobuf#boolvalue">BoolValue</a>) Whether to enable out-of-band utilization reporting collection from
the endpoints. By default, per-request utilization reporting is used.</p>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-load-balancing-policies-client-side-weighted-round-robin-v3-clientsideweightedroundrobin-oob-reporting-period">
<dt>oob_reporting_period</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/reference/google.protobuf#duration">Duration</a>) Load reporting interval to request from the server. Note that the
server may not provide reports as frequently as the client requests.
Used only when enable_oob_load_report is true. Default is 10 seconds.</p>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-load-balancing-policies-client-side-weighted-round-robin-v3-clientsideweightedroundrobin-blackout-period">
<dt>blackout_period</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/reference/google.protobuf#duration">Duration</a>) A given endpoint must report load metrics continuously for at least
this long before the endpoint weight will be used. This avoids
churn when the set of endpoint addresses changes. Takes effect
both immediately after we establish a connection to an endpoint and
after weight_expiration_period has caused us to stop using the most
recent load metrics. Default is 10 seconds.</p>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-load-balancing-policies-client-side-weighted-round-robin-v3-clientsideweightedroundrobin-weight-expiration-period">
<dt>weight_expiration_period</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/reference/google.protobuf#duration">Duration</a>) If a given endpoint has not reported load metrics in this long,
then we stop using the reported weight. This ensures that we do
not continue to use very stale weights. Once we stop using a stale
value, if we later start seeing fresh reports again, the
blackout_period applies. Defaults to 3 minutes.</p>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-load-balancing-policies-client-side-weighted-round-robin-v3-clientsideweightedroundrobin-weight-update-period">
<dt>weight_update_period</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/reference/google.protobuf#duration">Duration</a>) How often endpoint weights are recalculated. Values less than 100ms are
capped at 100ms. Default is 1 second.</p>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-load-balancing-policies-client-side-weighted-round-robin-v3-clientsideweightedroundrobin-error-utilization-penalty">
<dt>error_utilization_penalty</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/reference/google.protobuf#floatvalue">FloatValue</a>) The multiplier used to adjust endpoint weights with the error rate
calculated as eps/qps. Configuration is rejected if this value is negative.
Default is 1.0.</p>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-load-balancing-policies-client-side-weighted-round-robin-v3-clientsideweightedroundrobin-metric-names-for-computing-utilization">
<dt>metric_names_for_computing_utilization</dt><dd><p>(<strong>repeated</strong> <a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">string</a>) By default, endpoint weight is computed based on the <a class="reference internal" href="../../../../../xds/data/orca/v3/orca_load_report.proto.html#envoy-v3-api-field-xds-data-orca-v3-orcaloadreport-application-utilization"><span class="std std-ref">application_utilization</span></a> field reported by the endpoint.
If that field is not set, then utilization will instead be computed by taking the max of the values of the metrics specified here.
For map fields in the ORCA proto, the string will be of the form <code class="docutils literal notranslate"><span class="pre">&lt;map_field_name&gt;.&lt;map_key&gt;</span></code>. For example, the string <code class="docutils literal notranslate"><span class="pre">named_metrics.foo</span></code> will mean to look for the key <code class="docutils literal notranslate"><span class="pre">foo</span></code> in the ORCA <a class="reference internal" href="../../../../../xds/data/orca/v3/orca_load_report.proto.html#envoy-v3-api-field-xds-data-orca-v3-orcaloadreport-named-metrics"><span class="std std-ref">named_metrics</span></a> field.
If none of the specified metrics are present in the load report, then <a class="reference internal" href="../../../../../xds/data/orca/v3/orca_load_report.proto.html#envoy-v3-api-field-xds-data-orca-v3-orcaloadreport-cpu-utilization"><span class="std std-ref">cpu_utilization</span></a> is used instead.</p>
</dd>
</dl>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../../../../config/load_balancing_policies/load_balancing_policies.html" class="btn btn-neutral float-left" title="Load balancing policies" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../cluster_provided/v3/cluster_provided.proto.html" class="btn btn-neutral float-right" title="Cluster Provided Load Balancing Policy (proto)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2025, Envoy Project Authors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>