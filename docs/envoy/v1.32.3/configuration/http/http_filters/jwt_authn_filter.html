<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>JWT Authentication &mdash; envoy tag-v1.32.3 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=d7d10ef0" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/envoy.css?v=3ec0219e" />
      <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css?v=4da122e5" />

  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=85febebb"></script>
        <script src="../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../../_static/copybutton.js?v=db7b0edf"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Kill Request" href="kill_request_filter.html" />
    <link rel="prev" title="Envoy Json-To-Metadata Filter" href="json_to_metadata_filter.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html">
            
              <img src="../../../_static/envoy-logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                tag-v1.32.3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../about_docs.html">About the documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../intro/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../start/start.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../configuration.html">Configuration reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../overview/overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../listeners/listeners.html">Listeners</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../http.html">HTTP</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../http_conn_man/http_conn_man.html">HTTP connection manager</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="http_filters.html">HTTP filters</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="adaptive_concurrency_filter.html">Adaptive Concurrency</a></li>
<li class="toctree-l4"><a class="reference internal" href="admission_control_filter.html">Admission Control</a></li>
<li class="toctree-l4"><a class="reference internal" href="aws_lambda_filter.html">AWS Lambda</a></li>
<li class="toctree-l4"><a class="reference internal" href="aws_request_signing_filter.html">AWS Request Signing</a></li>
<li class="toctree-l4"><a class="reference internal" href="bandwidth_limit_filter.html">Bandwidth limit</a></li>
<li class="toctree-l4"><a class="reference internal" href="basic_auth_filter.html">Basic Auth</a></li>
<li class="toctree-l4"><a class="reference internal" href="buffer_filter.html">Buffer</a></li>
<li class="toctree-l4"><a class="reference internal" href="cache_filter.html">Cache filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="cdn_loop_filter.html">CDN-Loop header</a></li>
<li class="toctree-l4"><a class="reference internal" href="checksum_filter.html">Checksum</a></li>
<li class="toctree-l4"><a class="reference internal" href="compressor_filter.html">Compressor</a></li>
<li class="toctree-l4"><a class="reference internal" href="composite_filter.html">Composite Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="connect_grpc_bridge_filter.html">Connect-gRPC Bridge</a></li>
<li class="toctree-l4"><a class="reference internal" href="cors_filter.html">CORS</a></li>
<li class="toctree-l4"><a class="reference internal" href="credential_injector_filter.html">Credential injector</a></li>
<li class="toctree-l4"><a class="reference internal" href="csrf_filter.html">CSRF</a></li>
<li class="toctree-l4"><a class="reference internal" href="custom_response_filter.html">Custom Response Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="decompressor_filter.html">Decompressor</a></li>
<li class="toctree-l4"><a class="reference internal" href="dynamic_forward_proxy_filter.html">Dynamic forward proxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="dynamodb_filter.html">DynamoDB</a></li>
<li class="toctree-l4"><a class="reference internal" href="ext_authz_filter.html">External Authorization</a></li>
<li class="toctree-l4"><a class="reference internal" href="ext_proc_filter.html">External Processing</a></li>
<li class="toctree-l4"><a class="reference internal" href="fault_filter.html">Fault Injection</a></li>
<li class="toctree-l4"><a class="reference internal" href="file_system_buffer_filter.html">File System Buffer</a></li>
<li class="toctree-l4"><a class="reference internal" href="gcp_authn_filter.html">GCP Authentication Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="geoip_filter.html">IP Geolocation Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="golang_filter.html">Golang</a></li>
<li class="toctree-l4"><a class="reference internal" href="grpc_field_extraction_filter.html">gRPC Field Extraction</a></li>
<li class="toctree-l4"><a class="reference internal" href="grpc_http1_bridge_filter.html">gRPC HTTP/1.1 bridge</a></li>
<li class="toctree-l4"><a class="reference internal" href="grpc_http1_reverse_bridge_filter.html">gRPC HTTP/1.1 reverse bridge</a></li>
<li class="toctree-l4"><a class="reference internal" href="grpc_json_transcoder_filter.html">gRPC-JSON transcoder</a></li>
<li class="toctree-l4"><a class="reference internal" href="grpc_stats_filter.html">gRPC Statistics</a></li>
<li class="toctree-l4"><a class="reference internal" href="grpc_web_filter.html">gRPC-Web</a></li>
<li class="toctree-l4"><a class="reference internal" href="header_mutation_filter.html">Header Mutation</a></li>
<li class="toctree-l4"><a class="reference internal" href="health_check_filter.html">Health check</a></li>
<li class="toctree-l4"><a class="reference internal" href="header_to_metadata_filter.html">Envoy Header-To-Metadata Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="ip_tagging_filter.html">IP Tagging</a></li>
<li class="toctree-l4"><a class="reference internal" href="json_to_metadata_filter.html">Envoy Json-To-Metadata Filter</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">JWT Authentication</a></li>
<li class="toctree-l4"><a class="reference internal" href="kill_request_filter.html">Kill Request</a></li>
<li class="toctree-l4"><a class="reference internal" href="language_filter.html">Language</a></li>
<li class="toctree-l4"><a class="reference internal" href="local_rate_limit_filter.html">Local rate limit</a></li>
<li class="toctree-l4"><a class="reference internal" href="lua_filter.html">Lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="oauth2_filter.html">OAuth2</a></li>
<li class="toctree-l4"><a class="reference internal" href="on_demand_updates_filter.html">On-demand VHDS, S/RDS and CDS Updates</a></li>
<li class="toctree-l4"><a class="reference internal" href="original_src_filter.html">Original Source</a></li>
<li class="toctree-l4"><a class="reference internal" href="proto_message_extraction_filter.html">Proto Message Extraction</a></li>
<li class="toctree-l4"><a class="reference internal" href="rate_limit_filter.html">Rate limit</a></li>
<li class="toctree-l4"><a class="reference internal" href="rate_limit_quota_filter.html">Rate Limit Quota (Work-In-Progress)</a></li>
<li class="toctree-l4"><a class="reference internal" href="rbac_filter.html">Role Based Access Control (RBAC) Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="router_filter.html">Router</a></li>
<li class="toctree-l4"><a class="reference internal" href="set_filter_state.html">Set-Filter-State HTTP Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="set_metadata_filter.html">Set Metadata</a></li>
<li class="toctree-l4"><a class="reference internal" href="squash_filter.html">Squash</a></li>
<li class="toctree-l4"><a class="reference internal" href="stateful_session_filter.html">Stateful session</a></li>
<li class="toctree-l4"><a class="reference internal" href="sxg_filter.html">SXG</a></li>
<li class="toctree-l4"><a class="reference internal" href="tap_filter.html">Tap</a></li>
<li class="toctree-l4"><a class="reference internal" href="thrift_to_metadata_filter.html">Envoy Thrift-To-Metadata Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="upstream_codec_filter.html">Upstream Codec</a></li>
<li class="toctree-l4"><a class="reference internal" href="wasm_filter.html">Wasm</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../caches/caches.html">HTTP caches</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cluster_specifier/cluster_specifier.html">HTTP cluster specifier</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../upstream/upstream.html">Upstream clusters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../observability/observability.html">Observability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../security/security.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../operations/operations.html">Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../other_features/other_features.html">Other features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../other_protocols/other_protocols.html">Other protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../advanced/advanced.html">Advanced</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../best_practices/best_practices.html">Configuration best practices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../operations/operations.html">Operations and administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../extending/extending.html">Extending Envoy for custom use cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq/overview.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../version_history/version_history.html">Version history</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">envoy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../configuration.html">Configuration reference</a></li>
          <li class="breadcrumb-item"><a href="../http.html">HTTP</a></li>
          <li class="breadcrumb-item"><a href="http_filters.html">HTTP filters</a></li>
      <li class="breadcrumb-item active">JWT Authentication</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/configuration/http/http_filters/jwt_authn_filter.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="jwt-authentication">
<span id="config-http-filters-jwt-authn"></span><h1>JWT Authentication<a class="headerlink" href="#jwt-authentication" title="Link to this heading"></a></h1>
<p>This HTTP filter can be used to verify JSON Web Token (JWT). It will verify its signature, audiences and issuer. It will also check its time restrictions, such as expiration and nbf (not before) time. If the JWT verification fails, its request will be rejected. If the JWT verification succeeds, its payload can be forwarded to the upstream for further authorization if desired.</p>
<p>JWKS is needed to verify JWT signatures. They can be specified in the filter config or can be fetched remotely from a JWKS server.</p>
<p>Following are supported JWT alg:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ES256</span><span class="p">,</span> <span class="n">ES384</span><span class="p">,</span> <span class="n">ES512</span><span class="p">,</span>
<span class="n">HS256</span><span class="p">,</span> <span class="n">HS384</span><span class="p">,</span> <span class="n">HS512</span><span class="p">,</span>
<span class="n">RS256</span><span class="p">,</span> <span class="n">RS384</span><span class="p">,</span> <span class="n">RS512</span><span class="p">,</span>
<span class="n">PS256</span><span class="p">,</span> <span class="n">PS384</span><span class="p">,</span> <span class="n">PS512</span><span class="p">,</span>
<span class="n">EdDSA</span>
</pre></div>
</div>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>This filter should be configured with the type URL <code class="docutils literal notranslate"><span class="pre">type.googleapis.com/envoy.extensions.filters.http.jwt_authn.v3.JwtAuthentication</span></code>.</p></li>
<li><p><a class="reference internal" href="../../../api-v3/extensions/filters/http/jwt_authn/v3/config.proto.html#envoy-v3-api-msg-extensions-filters-http-jwt-authn-v3-jwtauthentication"><span class="std std-ref">v3 API reference</span></a></p></li>
</ul>
<p>This HTTP <a class="reference internal" href="../../../api-v3/extensions/filters/http/jwt_authn/v3/config.proto.html#envoy-v3-api-msg-extensions-filters-http-jwt-authn-v3-jwtauthentication"><span class="std std-ref">filter config</span></a> has two fields:</p>
<ul class="simple">
<li><p>Field <code class="docutils literal notranslate"><span class="pre">providers</span></code> specifies how a JWT should be verified, such as where to extract the token, where to fetch the public key (JWKS) and where to output its payload.</p></li>
<li><p>Field <code class="docutils literal notranslate"><span class="pre">rules</span></code> specifies matching rules and their requirements. If a request matches a rule, its requirement applies. The requirement specifies which JWT providers should be used.</p></li>
</ul>
<section id="jwtprovider">
<h3>JwtProvider<a class="headerlink" href="#jwtprovider" title="Link to this heading"></a></h3>
<p><a class="reference internal" href="../../../api-v3/extensions/filters/http/jwt_authn/v3/config.proto.html#envoy-v3-api-msg-extensions-filters-http-jwt-authn-v3-jwtprovider"><span class="std std-ref">JwtProvider</span></a> specifies how a JWT should be verified. It has the following fields:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">issuer</span></code>: the principal that issued the JWT, usually a URL or an email address.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">audiences</span></code>: a list of JWT audiences allowed to access. A JWT containing any of these audiences will be accepted.
If not specified, the audiences in JWT will not be checked.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">local_jwks</span></code>: fetch JWKS in local data source, either in a local file or embedded in the inline string.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">remote_jwks</span></code>: fetch JWKS from a remote HTTP server, also specify cache duration.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">forward</span></code>: if true, JWT will be forwarded to the upstream.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">from_headers</span></code>: extract JWT from HTTP headers.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">from_params</span></code>: extract JWT from query parameters.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">from_cookies</span></code>: extract JWT from HTTP request cookies.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">forward_payload_header</span></code>: forward the JWT payload in the specified HTTP header.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">claim_to_headers</span></code>: copy JWT claim to HTTP header.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">jwt_cache_config</span></code>: Enables JWT cache, its size can be specified by <code class="docutils literal notranslate"><span class="pre">jwt_cache_size</span></code>. Only valid JWT tokens are cached.</p></li>
</ul>
</section>
<section id="default-extract-location">
<h3>Default Extract Location<a class="headerlink" href="#default-extract-location" title="Link to this heading"></a></h3>
<p>If <a class="reference internal" href="../../../api-v3/extensions/filters/http/jwt_authn/v3/config.proto.html#envoy-v3-api-field-extensions-filters-http-jwt-authn-v3-jwtprovider-from-headers"><span class="std std-ref">from_headers</span></a> and
<a class="reference internal" href="../../../api-v3/extensions/filters/http/jwt_authn/v3/config.proto.html#envoy-v3-api-field-extensions-filters-http-jwt-authn-v3-jwtprovider-from-params"><span class="std std-ref">from_params</span></a> is empty, the default location to extract JWT is from HTTP header:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Authorization</span><span class="p">:</span> <span class="n">Bearer</span> <span class="o">&lt;</span><span class="n">token</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>and query parameter key <code class="docutils literal notranslate"><span class="pre">access_token</span></code> as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>/path?access_token=&lt;JWT&gt;
</pre></div>
</div>
<p>If a request has two tokens, one from the header and the other from the query parameter, all of them must be valid.</p>
<p>The <a class="reference internal" href="../../../api-v3/extensions/filters/http/jwt_authn/v3/config.proto.html#envoy-v3-api-field-extensions-filters-http-jwt-authn-v3-jwtauthentication-providers"><span class="std std-ref">providers</span></a> field is a map, to map <code class="docutils literal notranslate"><span class="pre">provider_name</span></code> to a <a class="reference internal" href="../../../api-v3/extensions/filters/http/jwt_authn/v3/config.proto.html#envoy-v3-api-msg-extensions-filters-http-jwt-authn-v3-jwtprovider"><span class="std std-ref">JwtProvider</span></a>. The <code class="docutils literal notranslate"><span class="pre">provider_name</span></code> must be unique, it is referred by the fields <a class="reference internal" href="../../../api-v3/extensions/filters/http/jwt_authn/v3/config.proto.html#envoy-v3-api-field-extensions-filters-http-jwt-authn-v3-jwtrequirement-provider-name"><span class="std std-ref">provider_name</span></a> and <a class="reference internal" href="../../../api-v3/extensions/filters/http/jwt_authn/v3/config.proto.html#envoy-v3-api-field-extensions-filters-http-jwt-authn-v3-providerwithaudiences-provider-name"><span class="std std-ref">provider_name</span></a>.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>If <a class="reference internal" href="../../../api-v3/extensions/filters/http/jwt_authn/v3/config.proto.html#envoy-v3-api-field-extensions-filters-http-jwt-authn-v3-jwtprovider-remote-jwks"><span class="std std-ref">remote_jwks</span></a> is used, a <code class="docutils literal notranslate"><span class="pre">jwks_cluster</span></code> cluster is required to be specified in the field
<a class="reference internal" href="../../../api-v3/config/core/v3/http_uri.proto.html#envoy-v3-api-field-config-core-v3-httpuri-cluster"><span class="std std-ref">cluster</span></a>.</p>
</div>
<p>Due to above requirement, <a class="reference external" href="https://openid.net/specs/openid-connect-discovery-1_0.html">OpenID Connect Discovery</a> is not supported since the URL to fetch JWKS is in the response of the discovery. It is not easy to setup a cluster config for a dynamic URL.</p>
</section>
<section id="token-extraction-from-custom-http-headers">
<h3>Token Extraction from Custom HTTP Headers<a class="headerlink" href="#token-extraction-from-custom-http-headers" title="Link to this heading"></a></h3>
<p>If the JWT needs to be extracted in other HTTP header, use <a class="reference internal" href="../../../api-v3/extensions/filters/http/jwt_authn/v3/config.proto.html#envoy-v3-api-field-extensions-filters-http-jwt-authn-v3-jwtprovider-from-headers"><span class="std std-ref">from_headers</span></a> to specify the header name.
In addition to the <a class="reference internal" href="../../../api-v3/extensions/filters/http/jwt_authn/v3/config.proto.html#envoy-v3-api-field-extensions-filters-http-jwt-authn-v3-jwtheader-name"><span class="std std-ref">name</span></a> field, which specifies the HTTP header name, the section can specify an optional <a class="reference internal" href="../../../api-v3/extensions/filters/http/jwt_authn/v3/config.proto.html#envoy-v3-api-field-extensions-filters-http-jwt-authn-v3-jwtheader-value-prefix"><span class="std std-ref">value_prefix</span></a> value, as in:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">from_headers</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">x-jwt-header</span>
<span class="w">    </span><span class="nt">value_prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">jwt_value</span>
</pre></div>
</div>
<p>The above will cause the jwt_authn filter to look for the JWT in the <code class="docutils literal notranslate"><span class="pre">x-jwt-header</span></code> header, following the tag <code class="docutils literal notranslate"><span class="pre">jwt_value</span></code>.
Any non-JWT characters (i.e., anything other than alphanumerics, <cite>_</cite>, <cite>-</cite>, and <cite>.</cite>) will be skipped,
and all following, contiguous, JWT-legal chars will be taken as the JWT.</p>
<p>This means all of the following will return a JWT of <code class="docutils literal notranslate"><span class="pre">eyJFbnZveSI6ICJyb2NrcyJ9.e30.c2lnbmVk</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">x-jwt-header</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">jwt_value=eyJFbnZveSI6ICJyb2NrcyJ9.e30.c2lnbmVk</span>

<span class="nt">x-jwt-header</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="s">&quot;jwt_value&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;eyJFbnZveSI6ICJyb2NrcyJ9.e30.c2lnbmVk&quot;</span><span class="p p-Indicator">}</span>

<span class="nt">x-jwt-header</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">beta:true,jwt_value:&quot;eyJFbnZveSI6ICJyb2NrcyJ9.e30.c2lnbmVk&quot;,trace=1234</span>
</pre></div>
</div>
<p>The header <a class="reference internal" href="../../../api-v3/extensions/filters/http/jwt_authn/v3/config.proto.html#envoy-v3-api-field-extensions-filters-http-jwt-authn-v3-jwtheader-name"><span class="std std-ref">name</span></a> may be <code class="docutils literal notranslate"><span class="pre">Authorization</span></code>.</p>
<p>The <a class="reference internal" href="../../../api-v3/extensions/filters/http/jwt_authn/v3/config.proto.html#envoy-v3-api-field-extensions-filters-http-jwt-authn-v3-jwtheader-value-prefix"><span class="std std-ref">value_prefix</span></a> must match exactly, i.e., case-sensitively.
If the <a class="reference internal" href="../../../api-v3/extensions/filters/http/jwt_authn/v3/config.proto.html#envoy-v3-api-field-extensions-filters-http-jwt-authn-v3-jwtheader-value-prefix"><span class="std std-ref">value_prefix</span></a> is not found, the header is skipped, not considered as a source for a JWT token.</p>
<p>If there are no JWT-legal characters after the <a class="reference internal" href="../../../api-v3/extensions/filters/http/jwt_authn/v3/config.proto.html#envoy-v3-api-field-extensions-filters-http-jwt-authn-v3-jwtheader-value-prefix"><span class="std std-ref">value_prefix</span></a>, the entire string after it
is taken to be the JWT token. This is unlikely to succeed; the error will reported by the JWT parser.</p>
</section>
<section id="remote-jwks-config-example">
<h3>Remote JWKS config example<a class="headerlink" href="#remote-jwks-config-example" title="Link to this heading"></a></h3>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">providers</span><span class="p">:</span>
<span class="w">  </span><span class="nt">provider_name1</span><span class="p">:</span>
<span class="w">    </span><span class="nt">issuer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://example.com</span>
<span class="w">    </span><span class="nt">audiences</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bookstore_android.apps.googleusercontent.com</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bookstore_web.apps.googleusercontent.com</span>
<span class="w">    </span><span class="nt">remote_jwks</span><span class="p">:</span>
<span class="w">      </span><span class="nt">http_uri</span><span class="p">:</span>
<span class="w">        </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://example.com/jwks.json</span>
<span class="w">        </span><span class="nt">cluster</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example_jwks_cluster</span>
<span class="w">        </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1s</span>
<span class="w">      </span><span class="nt">cache_duration</span><span class="p">:</span>
<span class="w">        </span><span class="nt">seconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">300</span>
</pre></div>
</div>
<p>Above example fetches JWKS from a remote server with URL <a class="reference external" href="https://example.com/jwks.json">https://example.com/jwks.json</a>. The token will be extracted from the default extract locations. The token will not be forwarded to upstream. JWT payload will not be added to the request header.</p>
<p>Following cluster <strong>example_jwks_cluster</strong> is needed to fetch JWKS.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">cluster</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example_jwks_cluster</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">STRICT_DNS</span>
<span class="w">  </span><span class="nt">load_assignment</span><span class="p">:</span>
<span class="w">    </span><span class="nt">cluster_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example_jwks_cluster</span>
<span class="w">    </span><span class="nt">endpoints</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">lb_endpoints</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">endpoint</span><span class="p">:</span>
<span class="w">          </span><span class="nt">address</span><span class="p">:</span>
<span class="w">            </span><span class="nt">socket_address</span><span class="p">:</span>
<span class="w">              </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example.com</span>
<span class="w">              </span><span class="nt">port_value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
<span class="w">  </span><span class="nt">transport_socket</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">envoy.transport_sockets.tls</span>
</pre></div>
</div>
</section>
<section id="inline-jwks-config-example">
<h3>Inline JWKS config example<a class="headerlink" href="#inline-jwks-config-example" title="Link to this heading"></a></h3>
<p>Another config example using inline JWKS:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">providers</span><span class="p">:</span>
<span class="w">  </span><span class="nt">provider_name2</span><span class="p">:</span>
<span class="w">    </span><span class="nt">issuer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://example2.com</span>
<span class="w">    </span><span class="nt">local_jwks</span><span class="p">:</span>
<span class="w">      </span><span class="nt">inline_string</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PUBLIC-KEY</span>
<span class="w">    </span><span class="nt">from_headers</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">jwt-assertion</span>
<span class="w">    </span><span class="nt">forward</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">forward_payload_header</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">x-jwt-payload</span>
</pre></div>
</div>
<p>Above example uses config inline string to specify JWKS. The JWT token will be extracted from HTTP headers as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">jwt</span><span class="o">-</span><span class="n">assertion</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">JWT</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>JWT payload will be added to the request header as following format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">-</span><span class="n">jwt</span><span class="o">-</span><span class="n">payload</span><span class="p">:</span> <span class="n">base64url_encoded</span><span class="p">(</span><span class="n">jwt_payload_in_JSON</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="requirementrule">
<h3>RequirementRule<a class="headerlink" href="#requirementrule" title="Link to this heading"></a></h3>
<p><a class="reference internal" href="../../../api-v3/extensions/filters/http/jwt_authn/v3/config.proto.html#envoy-v3-api-msg-extensions-filters-http-jwt-authn-v3-requirementrule"><span class="std std-ref">RequirementRule</span></a> has two fields:</p>
<ul class="simple">
<li><p>Field <code class="docutils literal notranslate"><span class="pre">match</span></code> specifies how a request can be matched; e.g. by HTTP headers, or by query parameters, or by path prefixes.</p></li>
<li><p>Field <code class="docutils literal notranslate"><span class="pre">requires</span></code> specifies the JWT requirement, e.g. which provider is required.</p></li>
</ul>
<div class="admonition important">
<p class="admonition-title">Important</p>
<ul class="simple">
<li><p><strong>If a request matches multiple rules, the first matched rule will apply</strong>.</p></li>
<li><p>If the matched rule has empty <code class="docutils literal notranslate"><span class="pre">requires</span></code> field, <strong>JWT verification is not required</strong>.</p></li>
<li><p>If a request doesn’t match any rules, <strong>JWT verification is not required</strong>.</p></li>
</ul>
</div>
</section>
<section id="single-requirement-config-example">
<h3>Single requirement config example<a class="headerlink" href="#single-requirement-config-example" title="Link to this heading"></a></h3>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">providers</span><span class="p">:</span>
<span class="w">  </span><span class="nt">jwt_provider1</span><span class="p">:</span>
<span class="w">    </span><span class="nt">issuer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://example.com</span>
<span class="w">    </span><span class="nt">audiences</span><span class="p">:</span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">audience1</span>
<span class="w">    </span><span class="nt">local_jwks</span><span class="p">:</span>
<span class="w">      </span><span class="nt">inline_string</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PUBLIC-KEY</span>
<span class="nt">rules</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">match</span><span class="p">:</span>
<span class="w">    </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/health</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">match</span><span class="p">:</span>
<span class="w">    </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/api</span>
<span class="w">  </span><span class="nt">requires</span><span class="p">:</span>
<span class="w">    </span><span class="nt">provider_and_audiences</span><span class="p">:</span>
<span class="w">      </span><span class="nt">provider_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">jwt_provider1</span>
<span class="w">      </span><span class="nt">audiences</span><span class="p">:</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">api_audience</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">match</span><span class="p">:</span>
<span class="w">    </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
<span class="w">  </span><span class="nt">requires</span><span class="p">:</span>
<span class="w">    </span><span class="nt">provider_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">jwt_provider1</span>
</pre></div>
</div>
<p>Above config uses single requirement rule, each rule may have either an empty requirement or a single requirement with one provider name.</p>
</section>
<section id="group-requirement-config-example">
<h3>Group requirement config example<a class="headerlink" href="#group-requirement-config-example" title="Link to this heading"></a></h3>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">providers</span><span class="p">:</span>
<span class="w">  </span><span class="nt">provider1</span><span class="p">:</span>
<span class="w">    </span><span class="nt">issuer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://provider1.com</span>
<span class="w">    </span><span class="nt">local_jwks</span><span class="p">:</span>
<span class="w">      </span><span class="nt">inline_string</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PUBLIC-KEY</span>
<span class="w">  </span><span class="nt">provider2</span><span class="p">:</span>
<span class="w">    </span><span class="nt">issuer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://provider2.com</span>
<span class="w">    </span><span class="nt">local_jwks</span><span class="p">:</span>
<span class="w">      </span><span class="nt">inline_string</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PUBLIC-KEY</span>
<span class="nt">rules</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">match</span><span class="p">:</span>
<span class="w">    </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/any</span>
<span class="w">  </span><span class="nt">requires</span><span class="p">:</span>
<span class="w">    </span><span class="nt">requires_any</span><span class="p">:</span>
<span class="w">      </span><span class="nt">requirements</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">provider_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">provider1</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">provider_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">provider2</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">match</span><span class="p">:</span>
<span class="w">    </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/all</span>
<span class="w">  </span><span class="nt">requires</span><span class="p">:</span>
<span class="w">    </span><span class="nt">requires_all</span><span class="p">:</span>
<span class="w">      </span><span class="nt">requirements</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">provider_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">provider1</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">provider_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">provider2</span>
</pre></div>
</div>
<p>Above config uses more complex <em>group</em> requirements:</p>
<ul class="simple">
<li><p>The first <em>rule</em> specifies <code class="docutils literal notranslate"><span class="pre">requires_any</span></code>; if any of <code class="docutils literal notranslate"><span class="pre">provider1</span></code> or <code class="docutils literal notranslate"><span class="pre">provider2</span></code> requirement is satisfied, the request is OK to proceed.</p></li>
<li><p>The second <em>rule</em> specifies <code class="docutils literal notranslate"><span class="pre">requires_all</span></code>; only if both <code class="docutils literal notranslate"><span class="pre">provider1</span></code> and <code class="docutils literal notranslate"><span class="pre">provider2</span></code> requirements are satisfied, the request is OK to proceed.</p></li>
</ul>
</section>
<section id="copy-validated-jwt-claims-to-http-request-headers-example">
<h3>Copy validated JWT claims to HTTP request headers example<a class="headerlink" href="#copy-validated-jwt-claims-to-http-request-headers-example" title="Link to this heading"></a></h3>
<p>If a JWT is valid, you can add some of its claims of type (string, integer, boolean) to a new HTTP header to pass to the upstream. You can specify claims and headers in
<cite>claim_to_headers</cite> field. Nested claims are also supported.</p>
<p>The field <a class="reference internal" href="../../../api-v3/extensions/filters/http/jwt_authn/v3/config.proto.html#envoy-v3-api-field-extensions-filters-http-jwt-authn-v3-jwtprovider-claim-to-headers"><span class="std std-ref">claim_to_headers</span></a> is a repeat of message <a class="reference internal" href="../../../api-v3/extensions/filters/http/jwt_authn/v3/config.proto.html#envoy-v3-api-msg-extensions-filters-http-jwt-authn-v3-jwtclaimtoheader"><span class="std std-ref">JWTClaimToHeader</span></a> which has two fields:</p>
<ul class="simple">
<li><p>Field <code class="docutils literal notranslate"><span class="pre">header_name</span></code> specifies the name of new http header reserved for jwt claim. If this header is already present with some other value then it will be replaced with the claim value. If the claim value doesn’t exist then this header wouldn’t be available for any other value.</p></li>
<li><p>Field <code class="docutils literal notranslate"><span class="pre">claim_name</span></code> specifies the claim from verified jwt token.</p></li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">providers</span><span class="p">:</span>
<span class="w">  </span><span class="nt">provider_name2</span><span class="p">:</span>
<span class="w">    </span><span class="nt">issuer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://example2.com</span>
<span class="w">    </span><span class="nt">claim_to_headers</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">header_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">x-jwt-claim-sub</span>
<span class="w">      </span><span class="nt">claim_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sub</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">header_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">x-jwt-claim-nested-key</span>
<span class="w">      </span><span class="nt">claim_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nested.claim.key</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">header_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">x-jwt-tenants</span>
<span class="w">      </span><span class="nt">claim_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tenants</span>
</pre></div>
</div>
<p>In this example the <cite>tenants</cite> claim is an object, therefore the JWT claim (“sub”, “nested.claim.key” and “tenants”) will be added to HTTP headers as following format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">-</span><span class="n">jwt</span><span class="o">-</span><span class="n">claim</span><span class="o">-</span><span class="n">sub</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">JWT</span> <span class="n">Claim</span><span class="o">&gt;</span>
<span class="n">x</span><span class="o">-</span><span class="n">jwt</span><span class="o">-</span><span class="n">claim</span><span class="o">-</span><span class="n">nested</span><span class="o">-</span><span class="n">key</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">JWT</span> <span class="n">Claim</span><span class="o">&gt;</span>
<span class="n">x</span><span class="o">-</span><span class="n">jwt</span><span class="o">-</span><span class="n">tenants</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">Base64</span> <span class="n">encoded</span> <span class="n">JSON</span> <span class="n">JWT</span> <span class="n">Claim</span><span class="o">&gt;</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="json_to_metadata_filter.html" class="btn btn-neutral float-left" title="Envoy Json-To-Metadata Filter" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="kill_request_filter.html" class="btn btn-neutral float-right" title="Kill Request" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2024, Envoy Project Authors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>