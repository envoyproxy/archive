

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Compressor &mdash; envoy tag-v1.33.6 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=d7d10ef0" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/envoy.css?v=3ec0219e" />
      <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css?v=4da122e5" />

  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=ac226a5c"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../../_static/copybutton.js?v=db7b0edf"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Composite Filter" href="composite_filter.html" />
    <link rel="prev" title="Checksum" href="checksum_filter.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html">
            
              <img src="../../../_static/envoy-logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../about_docs.html">About the documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../intro/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../start/start.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../configuration.html">Configuration reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../overview/overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../listeners/listeners.html">Listeners</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../http.html">HTTP</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../http_conn_man/http_conn_man.html">HTTP connection manager</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="http_filters.html">HTTP filters</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="adaptive_concurrency_filter.html">Adaptive Concurrency</a></li>
<li class="toctree-l4"><a class="reference internal" href="admission_control_filter.html">Admission Control</a></li>
<li class="toctree-l4"><a class="reference internal" href="aws_lambda_filter.html">AWS Lambda</a></li>
<li class="toctree-l4"><a class="reference internal" href="api_key_auth_filter.html">API key auth</a></li>
<li class="toctree-l4"><a class="reference internal" href="aws_request_signing_filter.html">AWS Request Signing</a></li>
<li class="toctree-l4"><a class="reference internal" href="bandwidth_limit_filter.html">Bandwidth limit</a></li>
<li class="toctree-l4"><a class="reference internal" href="basic_auth_filter.html">Basic Auth</a></li>
<li class="toctree-l4"><a class="reference internal" href="buffer_filter.html">Buffer</a></li>
<li class="toctree-l4"><a class="reference internal" href="cache_filter.html">Cache filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="cdn_loop_filter.html">CDN-Loop header</a></li>
<li class="toctree-l4"><a class="reference internal" href="checksum_filter.html">Checksum</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Compressor</a></li>
<li class="toctree-l4"><a class="reference internal" href="composite_filter.html">Composite Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="connect_grpc_bridge_filter.html">Connect-gRPC Bridge</a></li>
<li class="toctree-l4"><a class="reference internal" href="cors_filter.html">CORS</a></li>
<li class="toctree-l4"><a class="reference internal" href="credential_injector_filter.html">Credential injector</a></li>
<li class="toctree-l4"><a class="reference internal" href="csrf_filter.html">CSRF</a></li>
<li class="toctree-l4"><a class="reference internal" href="custom_response_filter.html">Custom Response Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="decompressor_filter.html">Decompressor</a></li>
<li class="toctree-l4"><a class="reference internal" href="dynamic_forward_proxy_filter.html">Dynamic forward proxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="dynamodb_filter.html">DynamoDB</a></li>
<li class="toctree-l4"><a class="reference internal" href="ext_authz_filter.html">External Authorization</a></li>
<li class="toctree-l4"><a class="reference internal" href="ext_proc_filter.html">External Processing</a></li>
<li class="toctree-l4"><a class="reference internal" href="fault_filter.html">Fault Injection</a></li>
<li class="toctree-l4"><a class="reference internal" href="file_system_buffer_filter.html">File System Buffer</a></li>
<li class="toctree-l4"><a class="reference internal" href="gcp_authn_filter.html">GCP Authentication Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="geoip_filter.html">IP Geolocation Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="golang_filter.html">Golang</a></li>
<li class="toctree-l4"><a class="reference internal" href="grpc_field_extraction_filter.html">gRPC Field Extraction</a></li>
<li class="toctree-l4"><a class="reference internal" href="grpc_http1_bridge_filter.html">gRPC HTTP/1.1 bridge</a></li>
<li class="toctree-l4"><a class="reference internal" href="grpc_http1_reverse_bridge_filter.html">gRPC HTTP/1.1 reverse bridge</a></li>
<li class="toctree-l4"><a class="reference internal" href="grpc_json_reverse_transcoder_filter.html">gRPC-JSON reverse transcoder</a></li>
<li class="toctree-l4"><a class="reference internal" href="grpc_json_transcoder_filter.html">gRPC-JSON transcoder</a></li>
<li class="toctree-l4"><a class="reference internal" href="grpc_stats_filter.html">gRPC Statistics</a></li>
<li class="toctree-l4"><a class="reference internal" href="grpc_web_filter.html">gRPC-Web</a></li>
<li class="toctree-l4"><a class="reference internal" href="header_mutation_filter.html">Header Mutation</a></li>
<li class="toctree-l4"><a class="reference internal" href="health_check_filter.html">Health check</a></li>
<li class="toctree-l4"><a class="reference internal" href="header_to_metadata_filter.html">Envoy Header-To-Metadata Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="ip_tagging_filter.html">IP Tagging</a></li>
<li class="toctree-l4"><a class="reference internal" href="json_to_metadata_filter.html">Envoy Json-To-Metadata Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="jwt_authn_filter.html">JWT Authentication</a></li>
<li class="toctree-l4"><a class="reference internal" href="kill_request_filter.html">Kill Request</a></li>
<li class="toctree-l4"><a class="reference internal" href="language_filter.html">Language</a></li>
<li class="toctree-l4"><a class="reference internal" href="local_rate_limit_filter.html">Local rate limit</a></li>
<li class="toctree-l4"><a class="reference internal" href="lua_filter.html">Lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="oauth2_filter.html">OAuth2</a></li>
<li class="toctree-l4"><a class="reference internal" href="on_demand_updates_filter.html">On-demand VHDS, S/RDS and CDS Updates</a></li>
<li class="toctree-l4"><a class="reference internal" href="original_src_filter.html">Original Source</a></li>
<li class="toctree-l4"><a class="reference internal" href="proto_message_extraction_filter.html">Proto Message Extraction</a></li>
<li class="toctree-l4"><a class="reference internal" href="rate_limit_filter.html">Rate limit</a></li>
<li class="toctree-l4"><a class="reference internal" href="rate_limit_quota_filter.html">Rate Limit Quota (Work-In-Progress)</a></li>
<li class="toctree-l4"><a class="reference internal" href="rbac_filter.html">Role Based Access Control (RBAC) Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="router_filter.html">Router</a></li>
<li class="toctree-l4"><a class="reference internal" href="set_filter_state.html">Set-Filter-State HTTP Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="set_metadata_filter.html">Set Metadata</a></li>
<li class="toctree-l4"><a class="reference internal" href="squash_filter.html">Squash</a></li>
<li class="toctree-l4"><a class="reference internal" href="stateful_session_filter.html">Stateful session</a></li>
<li class="toctree-l4"><a class="reference internal" href="sxg_filter.html">SXG</a></li>
<li class="toctree-l4"><a class="reference internal" href="tap_filter.html">Tap</a></li>
<li class="toctree-l4"><a class="reference internal" href="thrift_to_metadata_filter.html">Envoy Thrift-To-Metadata Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="upstream_codec_filter.html">Upstream Codec</a></li>
<li class="toctree-l4"><a class="reference internal" href="wasm_filter.html">Wasm</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../caches/caches.html">HTTP caches</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cluster_specifier/cluster_specifier.html">HTTP cluster specifier</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../upstream/upstream.html">Upstream clusters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../observability/observability.html">Observability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../security/security.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../operations/operations.html">Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../other_features/other_features.html">Other features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../other_protocols/other_protocols.html">Other protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../advanced/advanced.html">Advanced</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../best_practices/best_practices.html">Configuration best practices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../operations/operations.html">Operations and administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../extending/extending.html">Extending Envoy for custom use cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq/overview.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../version_history/version_history.html">Version history</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">envoy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../configuration.html">Configuration reference</a></li>
          <li class="breadcrumb-item"><a href="../http.html">HTTP</a></li>
          <li class="breadcrumb-item"><a href="http_filters.html">HTTP filters</a></li>
      <li class="breadcrumb-item active">Compressor</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/configuration/http/http_filters/compressor_filter.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="compressor">
<span id="config-http-filters-compressor"></span><h1>Compressor<a class="headerlink" href="#compressor" title="Link to this heading"></a></h1>
<p>Compressor is an HTTP filter which enables Envoy to compress dispatched data
from an upstream service upon client request. Compression is useful in
situations when bandwidth is scarce and large payloads can be effectively compressed
at the expense of higher CPU load or offloading it to a compression accelerator.</p>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>This filter should be configured with the type URL <code class="docutils literal notranslate"><span class="pre">type.googleapis.com/envoy.extensions.filters.http.compressor.v3.Compressor</span></code>.</p></li>
<li><p><a class="reference internal" href="../../../api-v3/extensions/filters/http/compressor/v3/compressor.proto.html#envoy-v3-api-msg-extensions-filters-http-compressor-v3-compressor"><span class="std std-ref">v3 API reference</span></a></p></li>
</ul>
</section>
<section id="how-it-works">
<h2>How it works<a class="headerlink" href="#how-it-works" title="Link to this heading"></a></h2>
<p>When compressor filter is enabled, request and response headers are inspected to
determine whether or not the content should be compressed. The content is
compressed and then sent to the client with the appropriate headers, if
response and request allow.</p>
<p>Currently the filter supports <a class="reference internal" href="../../../api-v3/extensions/compression/gzip/compressor/v3/gzip.proto.html#envoy-v3-api-msg-extensions-compression-gzip-compressor-v3-gzip"><span class="std std-ref">gzip</span></a>,
<a class="reference internal" href="../../../api-v3/extensions/compression/brotli/compressor/v3/brotli.proto.html#envoy-v3-api-msg-extensions-compression-brotli-compressor-v3-brotli"><span class="std std-ref">brotli</span></a>
and <a class="reference internal" href="../../../api-v3/extensions/compression/zstd/compressor/v3/zstd.proto.html#envoy-v3-api-msg-extensions-compression-zstd-compressor-v3-zstd"><span class="std std-ref">zstd</span></a>
compression only. Other compression libraries can be supported as extensions.</p>
<p>An example configuration of the filter may look like the following:</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../../../_downloads/072a62ff0f4b3087572d838354e1e59c/compressor-filter.yaml"><code class="xref download docutils literal notranslate"><span class="pre">compressor-filter.yaml</span></code></a></span><a class="headerlink" href="#id1" title="Link to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos">37</span><span class="w">          </span><span class="nt">http_filters</span><span class="p">:</span>
<span class="linenos">38</span><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">envoy.filters.http.compressor</span>
<span class="linenos">39</span><span class="w">            </span><span class="nt">typed_config</span><span class="p">:</span>
<span class="linenos">40</span><span class="w">              </span><span class="s">&quot;@type&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.extensions.filters.http.compressor.v3.Compressor</span>
<span class="linenos">41</span><span class="w">              </span><span class="nt">response_direction_config</span><span class="p">:</span>
<span class="linenos">42</span><span class="w">                </span><span class="nt">common_config</span><span class="p">:</span>
<span class="linenos">43</span><span class="w">                  </span><span class="nt">min_content_length</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span>
<span class="linenos">44</span><span class="w">                  </span><span class="nt">content_type</span><span class="p">:</span>
<span class="linenos">45</span><span class="w">                  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">text/html</span>
<span class="linenos">46</span><span class="w">                  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">application/json</span>
<span class="linenos">47</span><span class="w">                </span><span class="nt">disable_on_etag_header</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="linenos">48</span><span class="w">              </span><span class="nt">request_direction_config</span><span class="p">:</span>
<span class="linenos">49</span><span class="w">                </span><span class="nt">common_config</span><span class="p">:</span>
<span class="linenos">50</span><span class="w">                  </span><span class="nt">enabled</span><span class="p">:</span>
<span class="linenos">51</span><span class="w">                    </span><span class="nt">default_value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="linenos">52</span><span class="w">                    </span><span class="nt">runtime_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">request_compressor_enabled</span>
<span class="linenos">53</span><span class="w">              </span><span class="nt">compressor_library</span><span class="p">:</span>
<span class="linenos">54</span><span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">text_optimized</span>
<span class="linenos">55</span><span class="w">                </span><span class="nt">typed_config</span><span class="p">:</span>
<span class="linenos">56</span><span class="w">                  </span><span class="s">&quot;@type&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.extensions.compression.gzip.compressor.v3.Gzip</span>
<span class="linenos">57</span><span class="w">                  </span><span class="nt">memory_level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="linenos">58</span><span class="w">                  </span><span class="nt">window_bits</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="linenos">59</span><span class="w">                  </span><span class="nt">compression_level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BEST_COMPRESSION</span>
<span class="linenos">60</span><span class="w">                  </span><span class="nt">compression_strategy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DEFAULT_STRATEGY</span>
</pre></div>
</div>
</div>
<p>By <em>default</em> request compression is disabled, but when enabled it will be <em>skipped</em> if:</p>
<ul class="simple">
<li><p>A request does <strong>not</strong> contain a <code class="docutils literal notranslate"><span class="pre">content-type</span></code> value that matches one of the selected
mime-types, which default to the following:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">application/javascript</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">application/json</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">application/xhtml+xml</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">image/svg+xml</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">text/css</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">text/html</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">text/plain</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">text/xml</span></code></p></li>
</ul>
</li>
<li><p>A request does <strong>not</strong> contain a <code class="docutils literal notranslate"><span class="pre">content-length</span></code> header.</p></li>
<li><p>A request contains a <code class="docutils literal notranslate"><span class="pre">content-encoding</span></code> header.</p></li>
<li><p>A request contains a <code class="docutils literal notranslate"><span class="pre">transfer-encoding</span></code> header whose value includes a known
compression name.</p></li>
</ul>
<p>By <em>default</em> response compression is enabled, but it will be <em>skipped</em> when:</p>
<ul class="simple">
<li><p>A request does <strong>not</strong> contain <code class="docutils literal notranslate"><span class="pre">accept-encoding</span></code> header.</p></li>
<li><p>A request contains an <code class="docutils literal notranslate"><span class="pre">accept-encoding</span></code> header, but it does not contain <code class="docutils literal notranslate"><span class="pre">gzip</span></code> or <code class="docutils literal notranslate"><span class="pre">\*</span></code>.</p></li>
<li><p>A request contains an <code class="docutils literal notranslate"><span class="pre">accept-encoding</span></code> header with <code class="docutils literal notranslate"><span class="pre">gzip</span></code> or <code class="docutils literal notranslate"><span class="pre">\*``</span></code> with the weight <code class="docutils literal notranslate"><span class="pre">q=0</span></code>. Note
that the <code class="docutils literal notranslate"><span class="pre">gzip</span></code> will have a higher weight than <code class="docutils literal notranslate"><span class="pre">\*</span></code>. For example, if <code class="docutils literal notranslate"><span class="pre">accept-encoding</span></code>
is <code class="docutils literal notranslate"><span class="pre">gzip;q=0,\*;q=1</span></code>, the filter will not compress. But if the header is set to
<code class="docutils literal notranslate"><span class="pre">\*;q=0,gzip;q=1</span></code>, the filter will compress.</p></li>
<li><p>A request whose <code class="docutils literal notranslate"><span class="pre">accept-encoding</span></code> header includes any encoding type with a higher
weight than <code class="docutils literal notranslate"><span class="pre">gzip</span></code>’s given the corresponding compression filter is present in the chain.</p></li>
<li><p>A response contains a <code class="docutils literal notranslate"><span class="pre">content-encoding</span></code> header.</p></li>
<li><p>A response contains a <code class="docutils literal notranslate"><span class="pre">cache-control``</span></code> header whose value includes <code class="docutils literal notranslate"><span class="pre">no-transform</span></code>.</p></li>
<li><p>A response contains a <code class="docutils literal notranslate"><span class="pre">transfer-encoding``</span></code> header whose value includes a known
compression name.</p></li>
<li><p>A response does <strong>not</strong> contain a <code class="docutils literal notranslate"><span class="pre">content-type</span></code> value that matches one of the selected
mime-types, which default to:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">application/javascript</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">application/json</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">application/xhtml+xml</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">image/svg+xml</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">text/css</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">text/html</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">text/plain</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">text/xml</span></code></p></li>
</ul>
</li>
<li><p>A response does <strong>not</strong> contain a <code class="docutils literal notranslate"><span class="pre">content-length</span></code> or <code class="docutils literal notranslate"><span class="pre">transfer-encoding</span></code> headers.</p></li>
<li><p>Response size is smaller than 30 bytes (only applicable when <code class="docutils literal notranslate"><span class="pre">transfer-encoding</span></code>
is not chunked).</p></li>
</ul>
<p>Please note that in case the filter is configured to use a compression library extension
other than gzip it looks for content encoding in the <code class="docutils literal notranslate"><span class="pre">accept-encoding</span></code> header provided by
the extension.</p>
<p>When response compression is <em>applied</em>:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">content-length</span></code> is removed from response headers.</p></li>
<li><p>Response headers contain <code class="docutils literal notranslate"><span class="pre">transfer-encoding:</span> <span class="pre">chunked</span></code>, and
<code class="docutils literal notranslate"><span class="pre">content-encoding</span></code> with the compression scheme used (e.g., <code class="docutils literal notranslate"><span class="pre">gzip</span></code>).</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">vary:</span> <span class="pre">accept-encoding</span></code> header is inserted on every response.</p></li>
</ul>
<p>Also the <code class="docutils literal notranslate"><span class="pre">vary:</span> <span class="pre">accept-encoding</span></code> header may be inserted even if compression is <strong>not</strong>
applied due to incompatible <code class="docutils literal notranslate"><span class="pre">accept-encoding</span></code> header in a request. This happens
when the requested resource can still be compressed given compatible <code class="docutils literal notranslate"><span class="pre">accept-encoding</span></code>.
Otherwise, if an uncompressed response is cached by a caching proxy in front of Envoy,
the proxy won’t know to fetch a new incoming request with compatible <code class="docutils literal notranslate"><span class="pre">accept-encoding</span></code>
from upstream.</p>
<p>When request compression is <em>applied</em>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">content-length</span></code> is removed from request headers.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">content-encoding</span></code> with the compression scheme used (e.g., <code class="docutils literal notranslate"><span class="pre">gzip</span></code>) is added to
request headers.</p></li>
</ul>
</section>
<section id="per-route-configuration">
<h2>Per-Route Configuration<a class="headerlink" href="#per-route-configuration" title="Link to this heading"></a></h2>
<p>Response compression can be enabled and disabled on individual virtual hosts and routes.
For example, to disable response compression for a particular virtual host, but enable response compression for its <code class="docutils literal notranslate"><span class="pre">/static</span></code> route:</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../../../_downloads/072a62ff0f4b3087572d838354e1e59c/compressor-filter.yaml"><code class="xref download docutils literal notranslate"><span class="pre">compressor-filter.yaml</span></code></a></span><a class="headerlink" href="#id2" title="Link to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos">14</span><span class="w">          </span><span class="nt">route_config</span><span class="p">:</span>
<span class="linenos">15</span><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local_route</span>
<span class="linenos">16</span><span class="w">            </span><span class="nt">virtual_hosts</span><span class="p">:</span>
<span class="linenos">17</span><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local_service</span>
<span class="linenos">18</span><span class="w">              </span><span class="nt">domains</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;*&quot;</span><span class="p p-Indicator">]</span>
<span class="linenos">19</span><span class="w">              </span><span class="nt">typed_per_filter_config</span><span class="p">:</span>
<span class="linenos">20</span><span class="w">                </span><span class="nt">envoy.filters.http.compression</span><span class="p">:</span>
<span class="linenos">21</span><span class="w">                  </span><span class="s">&quot;@type&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.extensions.filters.http.compressor.v3.CompressorPerRoute</span>
<span class="linenos">22</span><span class="w">                  </span><span class="nt">disabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="linenos">23</span><span class="w">              </span><span class="nt">routes</span><span class="p">:</span>
<span class="linenos">24</span><span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">match</span><span class="p">:</span>
<span class="linenos">25</span><span class="w">                  </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/static&quot;</span>
<span class="linenos">26</span><span class="w">                </span><span class="nt">route</span><span class="p">:</span>
<span class="linenos">27</span><span class="w">                  </span><span class="nt">cluster</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">service</span>
<span class="linenos">28</span><span class="w">                </span><span class="nt">typed_per_filter_config</span><span class="p">:</span>
<span class="linenos">29</span><span class="w">                  </span><span class="nt">envoy.filters.http.compression</span><span class="p">:</span>
<span class="linenos">30</span><span class="w">                    </span><span class="s">&quot;@type&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.extensions.filters.http.compressor.v3.CompressorPerRoute</span>
<span class="linenos">31</span><span class="w">                    </span><span class="nt">overrides</span><span class="p">:</span>
<span class="linenos">32</span><span class="w">                      </span><span class="nt">response_direction_config</span><span class="p">:</span>
<span class="linenos">33</span><span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">match</span><span class="p">:</span>
<span class="linenos">34</span><span class="w">                  </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/&quot;</span>
<span class="linenos">35</span><span class="w">                </span><span class="nt">route</span><span class="p">:</span>
<span class="linenos">36</span><span class="w">                  </span><span class="nt">cluster</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">service</span>
</pre></div>
</div>
</div>
</section>
<section id="using-different-compressors-for-requests-and-responses">
<h2>Using different compressors for requests and responses<a class="headerlink" href="#using-different-compressors-for-requests-and-responses" title="Link to this heading"></a></h2>
<p>If different compression libraries are desired for requests and responses, it is possible to install
multiple compressor filters enabled only for requests or responses. For instance:</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../../../_downloads/a4cbed34a5d00098b1b681ee5a703b62/compressor-filter-request-response.yaml"><code class="xref download docutils literal notranslate"><span class="pre">compressor-filter-request-response.yaml</span></code></a></span><a class="headerlink" href="#id3" title="Link to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="w">          </span><span class="nt">http_filters</span><span class="p">:</span>
<span class="linenos"> 2</span><span class="w">          </span><span class="c1"># This filter is only enabled for responses.</span>
<span class="linenos"> 3</span><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">envoy.filters.http.compressor</span>
<span class="linenos"> 4</span><span class="w">            </span><span class="nt">typed_config</span><span class="p">:</span>
<span class="linenos"> 5</span><span class="w">              </span><span class="s">&quot;@type&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.extensions.filters.http.compressor.v3.Compressor</span>
<span class="linenos"> 6</span><span class="w">              </span><span class="nt">request_direction_config</span><span class="p">:</span>
<span class="linenos"> 7</span><span class="w">                </span><span class="nt">common_config</span><span class="p">:</span>
<span class="linenos"> 8</span><span class="w">                  </span><span class="nt">enabled</span><span class="p">:</span>
<span class="linenos"> 9</span><span class="w">                    </span><span class="nt">default_value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="linenos">10</span><span class="w">                    </span><span class="nt">runtime_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">request_compressor_enabled</span>
<span class="linenos">11</span><span class="w">              </span><span class="nt">compressor_library</span><span class="p">:</span>
<span class="linenos">12</span><span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">for_response</span>
<span class="linenos">13</span><span class="w">                </span><span class="nt">typed_config</span><span class="p">:</span>
<span class="linenos">14</span><span class="w">                  </span><span class="s">&quot;@type&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.extensions.compression.gzip.compressor.v3.Gzip</span>
<span class="linenos">15</span><span class="w">                  </span><span class="nt">memory_level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="linenos">16</span><span class="w">                  </span><span class="nt">window_bits</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="linenos">17</span><span class="w">                  </span><span class="nt">compression_level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BEST_COMPRESSION</span>
<span class="linenos">18</span><span class="w">                  </span><span class="nt">compression_strategy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DEFAULT_STRATEGY</span>
<span class="linenos">19</span><span class="w">          </span><span class="c1"># This filter is only enabled for requests.</span>
<span class="linenos">20</span><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">envoy.filters.http.compressor</span>
<span class="linenos">21</span><span class="w">            </span><span class="nt">typed_config</span><span class="p">:</span>
<span class="linenos">22</span><span class="w">              </span><span class="s">&quot;@type&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.extensions.filters.http.compressor.v3.Compressor</span>
<span class="linenos">23</span><span class="w">              </span><span class="nt">response_direction_config</span><span class="p">:</span>
<span class="linenos">24</span><span class="w">                </span><span class="nt">common_config</span><span class="p">:</span>
<span class="linenos">25</span><span class="w">                  </span><span class="nt">enabled</span><span class="p">:</span>
<span class="linenos">26</span><span class="w">                    </span><span class="nt">default_value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="linenos">27</span><span class="w">                    </span><span class="nt">runtime_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">response_compressor_enabled</span>
<span class="linenos">28</span><span class="w">              </span><span class="nt">request_direction_config</span><span class="p">:</span>
<span class="linenos">29</span><span class="w">                </span><span class="nt">common_config</span><span class="p">:</span>
<span class="linenos">30</span><span class="w">                  </span><span class="nt">enabled</span><span class="p">:</span>
<span class="linenos">31</span><span class="w">                    </span><span class="nt">default_value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="linenos">32</span><span class="w">                    </span><span class="nt">runtime_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">request_compressor_enabled</span>
<span class="linenos">33</span><span class="w">              </span><span class="nt">compressor_library</span><span class="p">:</span>
<span class="linenos">34</span><span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">for_request</span>
<span class="linenos">35</span><span class="w">                </span><span class="nt">typed_config</span><span class="p">:</span>
<span class="linenos">36</span><span class="w">                  </span><span class="s">&quot;@type&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.extensions.compression.gzip.compressor.v3.Gzip</span>
<span class="linenos">37</span><span class="w">                  </span><span class="nt">memory_level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9</span>
<span class="linenos">38</span><span class="w">                  </span><span class="nt">window_bits</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15</span>
<span class="linenos">39</span><span class="w">                  </span><span class="nt">compression_level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BEST_SPEED</span>
<span class="linenos">40</span><span class="w">                  </span><span class="nt">compression_strategy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DEFAULT_STRATEGY</span>
</pre></div>
</div>
</div>
</section>
<section id="statistics">
<span id="compressor-statistics"></span><h2>Statistics<a class="headerlink" href="#statistics" title="Link to this heading"></a></h2>
<p>Every configured Compressor filter has statistics rooted at
&lt;stat_prefix&gt;.compressor.&lt;compressor_library.name&gt;.&lt;compressor_library_stat_prefix&gt;.&lt;direction_prefix&gt;.*
with the following:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 25.0%" />
<col style="width: 25.0%" />
<col style="width: 50.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>compressed</p></td>
<td><p>Counter</p></td>
<td><p>Number of requests compressed.</p></td>
</tr>
<tr class="row-odd"><td><p>not_compressed</p></td>
<td><p>Counter</p></td>
<td><p>Number of requests not compressed.</p></td>
</tr>
<tr class="row-even"><td><p>total_uncompressed_bytes</p></td>
<td><p>Counter</p></td>
<td><p>The total uncompressed bytes of all the requests that were marked for compression.</p></td>
</tr>
<tr class="row-odd"><td><p>total_compressed_bytes</p></td>
<td><p>Counter</p></td>
<td><p>The total compressed bytes of all the requests that were marked for compression.</p></td>
</tr>
<tr class="row-even"><td><p>content_length_too_small</p></td>
<td><p>Counter</p></td>
<td><p>Number of requests that accepted the compressor encoding but did not compress because the payload was too small.</p></td>
</tr>
</tbody>
</table>
<p>In addition to the statics common for requests and responses there are statistics
specific to responses only:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 25.0%" />
<col style="width: 25.0%" />
<col style="width: 50.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>no_accept_header</p></td>
<td><p>Counter</p></td>
<td><p>Number of requests with no accept header sent.</p></td>
</tr>
<tr class="row-odd"><td><p>header_identity</p></td>
<td><p>Counter</p></td>
<td><p>Number of requests sent with “identity” set as the <code class="docutils literal notranslate"><span class="pre">accept-encoding</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p>header_compressor_used</p></td>
<td><p>Counter</p></td>
<td><p>Number of requests sent with filter’s configured encoding set as the <code class="docutils literal notranslate"><span class="pre">accept-encoding</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p>header_compressor_overshadowed</p></td>
<td><p>Counter</p></td>
<td><p>Number of requests skipped by this filter instance because they were handled by another filter in the same filter chain.</p></td>
</tr>
<tr class="row-even"><td><p>header_wildcard</p></td>
<td><p>Counter</p></td>
<td><p>Number of requests sent with <code class="docutils literal notranslate"><span class="pre">\*</span></code> set as the <code class="docutils literal notranslate"><span class="pre">accept-encoding</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p>header_not_valid</p></td>
<td><p>Counter</p></td>
<td><p>Number of requests sent with a not valid <code class="docutils literal notranslate"><span class="pre">accept-encoding</span></code> header (aka <code class="docutils literal notranslate"><span class="pre">q=0</span></code> or an unsupported encoding type).</p></td>
</tr>
<tr class="row-even"><td><p>not_compressed_etag</p></td>
<td><p>Counter</p></td>
<td><p>Number of requests that were not compressed due to the etag header. <code class="docutils literal notranslate"><span class="pre">disable_on_etag_header</span></code> must be turned on for this to happen.</p></td>
</tr>
</tbody>
</table>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="checksum_filter.html" class="btn btn-neutral float-left" title="Checksum" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="composite_filter.html" class="btn btn-neutral float-right" title="Composite Filter" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2025, Envoy Project Authors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>