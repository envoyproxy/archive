

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TCP Proxy (proto) &mdash; envoy tag-v1.34.3 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../../../_static/pygments.css?v=d7d10ef0" />
      <link rel="stylesheet" type="text/css" href="../../../../../../_static/css/envoy.css?v=3ec0219e" />
      <link rel="stylesheet" type="text/css" href="../../../../../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../../../../../_static/tabs.css?v=4da122e5" />

  
    <link rel="shortcut icon" href="../../../../../../_static/favicon.ico"/>
      <script src="../../../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../../../_static/documentation_options.js?v=7a70052c"></script>
      <script src="../../../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../../../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../../../../../_static/copybutton.js?v=db7b0edf"></script>
    <script src="../../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../search.html" />
    <link rel="next" title="Thrift Proxy Route Configuration (proto)" href="../../thrift_proxy/v3/route.proto.html" />
    <link rel="prev" title="SNI dynamic forward proxy (proto)" href="../../sni_dynamic_forward_proxy/v3/sni_dynamic_forward_proxy.proto.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../../index.html">
            
              <img src="../../../../../../_static/envoy-logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../../../about_docs.html">About the documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../intro/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../start/start.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../configuration/configuration.html">Configuration reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../operations/operations.html">Operations and administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../extending/extending.html">Extending Envoy for custom use cases</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../../../../api/api.html">API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../../../../api/api_supported_versions.html">Supported API versions</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../../../api.html">v3 API reference</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../../../../bootstrap/bootstrap.html">Bootstrap</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../listeners/listeners.html">Listeners</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../clusters/clusters.html">Clusters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../http_routes/http_routes.html">HTTP route management</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../../../../../config/config.html">Extensions</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/accesslog/filters.html">Access log extension filters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/formatter/formatter.html">Access log formatters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/accesslog/accesslog.html">Access loggers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/cluster/cluster.html">Cluster</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/common/common.html">Common</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/compression/compression.html">Compression</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/config_validators/config_validators.html">Config validators</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/contrib/contrib.html">Contrib extensions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/dns_resolver/dns_resolver.html">DNS resolver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/endpoint/endpoint.html">Endpoint</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="../../../../../config/filter/filter.html">Filters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/grpc_credential/grpc_credential.html">Grpc credentials</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/health_check_event_sinks/health_check_event_sinks.html">Health check event sinks</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/health_checker/health_checker.html">Health checkers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/http/early_header_mutation.html">HTTP early header mutation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/http/custom_response.html">Custom response policies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/http/ext_proc.html">External Processing Extensions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/http/header_formatters.html">HTTP header formatters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/http/header_validators.html">HTTP header validators</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/http/original_ip_detection.html">HTTP original IP detection</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/http/stateful_session.html">HTTP stateful session</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/injected_credentials/injected_credentials.html">Injected credentials</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/geoip_provider/geoip_provider.html">Geolocation providers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/trace/trace.html">HTTP tracers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/internal_redirect/internal_redirect.html">Internal redirect predicates</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/path/match/path_matcher.html">Path matcher</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/path/rewrite/path_rewriter.html">Path rewriter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/quic/quic_extensions.html">Quic extensions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/descriptors/descriptors.html">Rate limit descriptors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/rbac/rbac.html">RBAC</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/rbac/matchers.html">RBAC matchers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/rbac/matchers.html#rbac-principals">RBAC principals</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/request_id/request_id.html">Request ID</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/resource_monitor/resource_monitor.html">Resource monitors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/retry/retry.html">Retry predicates</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/stat_sinks/stat_sinks.html">Stat sinks</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/string_matcher/string_matcher.html">String Matcher</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/transport_socket/transport_socket.html">Transport sockets</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/upstream/upstream.html">Upstream configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/wasm/wasm.html">WASM</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/watchdog/watchdog.html">Watchdog</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/load_balancing_policies/load_balancing_policies.html">Load balancing policies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/cluster_specifier/cluster_specifier.html">Cluster specifier</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../admin/admin.html">Admin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../data/data.html">Envoy data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../service/service.html">Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../common_messages/common_messages.html">Common messages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../common_messages/common_messages_xds.html">Common messages (XDS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../types/types.html">Types</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../api-docs/xds_protocol.html">xDS REST and gRPC protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../api/client_features.html">Well Known Client Features</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../faq/overview.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../version_history/version_history.html">Version history</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../index.html">envoy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../../../../api/api.html">API</a></li>
          <li class="breadcrumb-item"><a href="../../../../../api.html">v3 API reference</a></li>
          <li class="breadcrumb-item"><a href="../../../../../config/config.html">Extensions</a></li>
          <li class="breadcrumb-item"><a href="../../../../../config/filter/filter.html">Filters</a></li>
          <li class="breadcrumb-item"><a href="../../../../../config/filter/network/network.html">Network filters</a></li>
      <li class="breadcrumb-item active">TCP Proxy (proto)</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../../_sources/api-v3/extensions/filters/network/tcp_proxy/v3/tcp_proxy.proto.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="tcp-proxy-proto">
<span id="envoy-v3-api-file-envoy-extensions-filters-network-tcp-proxy-v3-tcp-proxy-proto"></span><h1>TCP Proxy (proto)<a class="headerlink" href="#tcp-proxy-proto" title="Link to this heading"></a></h1>
<p id="extension-envoy-filters-network-tcp-proxy">This extension has the qualified name <code class="docutils literal notranslate"><span class="pre">envoy.filters.network.tcp_proxy</span></code></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This extension is intended to be robust against untrusted downstream traffic. It
assumes that the upstream is trusted.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>This extension extends and can be used with the following extension category:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../../../health_checkers/thrift/v3/thrift.proto.html#extension-category-envoy-filters-network"><span class="std std-ref">envoy.filters.network</span></a></p></li>
</ul>
<p>This extension must be configured with one of the following type URLs:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#envoy-v3-api-msg-extensions-filters-network-tcp-proxy-v3-tcpproxy"><span class="std std-ref">type.googleapis.com/envoy.extensions.filters.network.tcp_proxy.v3.TcpProxy</span></a></p></li>
</ul>
</div>
<p>TCP Proxy <a class="reference internal" href="../../../../../../configuration/listeners/network_filters/tcp_proxy_filter.html#config-network-filters-tcp-proxy"><span class="std std-ref">configuration overview</span></a>.</p>
<section id="extensions-filters-network-tcp-proxy-v3-tcpproxy">
<span id="envoy-v3-api-msg-extensions-filters-network-tcp-proxy-v3-tcpproxy"></span><h2>extensions.filters.network.tcp_proxy.v3.TcpProxy<a class="headerlink" href="#extensions-filters-network-tcp-proxy-v3-tcpproxy" title="Link to this heading"></a></h2>
<p><a class="extlink-repo reference external" href="https://github.com/envoyproxy/envoy/blob/v1.34.3/api/envoy/extensions/filters/network/tcp_proxy/v3/tcp_proxy.proto#L30">[extensions.filters.network.tcp_proxy.v3.TcpProxy proto]</a></p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;stat_prefix&quot;</span><span class="p">:</span><span class="w"> </span><span class="err">...</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;cluster&quot;</span><span class="p">:</span><span class="w"> </span><span class="err">...</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;weighted_clusters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;on_demand&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;metadata_match&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;idle_timeout&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;access_log&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">  </span><span class="nt">&quot;max_connect_attempts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;backoff_options&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;hash_policy&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">  </span><span class="nt">&quot;tunneling_config&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;max_downstream_connection_duration&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;access_log_flush_interval&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;flush_access_log_on_connected&quot;</span><span class="p">:</span><span class="w"> </span><span class="err">...</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;access_log_options&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;proxy_protocol_tlvs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-stat-prefix">
<dt>stat_prefix</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">string</a>, <em>REQUIRED</em>) The prefix to use when emitting <a class="reference internal" href="../../../../../../configuration/listeners/network_filters/tcp_proxy_filter.html#config-network-filters-tcp-proxy-stats"><span class="std std-ref">statistics</span></a>.</p>
</dd>
</dl>
<dl id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-cluster">
<dt>cluster</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">string</a>) The upstream cluster to connect to.</p>
<p>Precisely one of <a class="reference internal" href="#envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-cluster"><span class="std std-ref">cluster</span></a>, <a class="reference internal" href="#envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-weighted-clusters"><span class="std std-ref">weighted_clusters</span></a> must be set.</p>
</dd>
</dl>
<dl id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-weighted-clusters">
<dt>weighted_clusters</dt><dd><p>(<a class="reference internal" href="#envoy-v3-api-msg-extensions-filters-network-tcp-proxy-v3-tcpproxy-weightedcluster"><span class="std std-ref">extensions.filters.network.tcp_proxy.v3.TcpProxy.WeightedCluster</span></a>) Multiple upstream clusters can be specified for a given route. The
request is routed to one of the upstream clusters based on weights
assigned to each cluster.</p>
<p>Precisely one of <a class="reference internal" href="#envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-cluster"><span class="std std-ref">cluster</span></a>, <a class="reference internal" href="#envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-weighted-clusters"><span class="std std-ref">weighted_clusters</span></a> must be set.</p>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-on-demand">
<dt>on_demand</dt><dd><p>(<a class="reference internal" href="#envoy-v3-api-msg-extensions-filters-network-tcp-proxy-v3-tcpproxy-ondemand"><span class="std std-ref">extensions.filters.network.tcp_proxy.v3.TcpProxy.OnDemand</span></a>) The on demand policy for the upstream cluster.
It applies to both
<a class="reference internal" href="#envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-cluster"><span class="std std-ref">TcpProxy.cluster</span></a>
and
<a class="reference internal" href="#envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-weighted-clusters"><span class="std std-ref">TcpProxy.weighted_clusters</span></a>.</p>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-metadata-match">
<dt>metadata_match</dt><dd><p>(<a class="reference internal" href="../../../../../config/core/v3/base.proto.html#envoy-v3-api-msg-config-core-v3-metadata"><span class="std std-ref">config.core.v3.Metadata</span></a>) Optional endpoint metadata match criteria used by the subset load balancer. Only endpoints
in the upstream cluster with metadata matching what is set in this field will be considered
for load balancing. The filter name should be specified as <code class="docutils literal notranslate"><span class="pre">envoy.lb</span></code>.</p>
</dd>
</dl>
<dl id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-idle-timeout">
<dt>idle_timeout</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/reference/google.protobuf#duration">Duration</a>) The idle timeout for connections managed by the TCP proxy filter. The idle timeout
is defined as the period in which there are no bytes sent or received on either
the upstream or downstream connection. If not set, the default idle timeout is 1 hour. If set
to 0s, the timeout will be disabled.
It is possible to dynamically override this configuration by setting a per-connection filter
state object for the key <code class="docutils literal notranslate"><span class="pre">envoy.tcp_proxy.per_connection_idle_timeout_ms</span></code>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Disabling this timeout has a highly likelihood of yielding connection leaks due to lost TCP
FIN packets, etc.</p>
</div>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-access-log">
<dt>access_log</dt><dd><p>(<strong>repeated</strong> <a class="reference internal" href="../../../../../config/accesslog/v3/accesslog.proto.html#envoy-v3-api-msg-config-accesslog-v3-accesslog"><span class="std std-ref">config.accesslog.v3.AccessLog</span></a>) Configuration for <a class="reference internal" href="../../../../../../intro/arch_overview/observability/access_logging.html#arch-overview-access-logs"><span class="std std-ref">access logs</span></a>
emitted by the this tcp_proxy.</p>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-max-connect-attempts">
<dt>max_connect_attempts</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/reference/google.protobuf#uint32value">UInt32Value</a>) The maximum number of unsuccessful connection attempts that will be made before
giving up. If the parameter is not specified, 1 connection attempt will be made.</p>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-backoff-options">
<dt>backoff_options</dt><dd><p>(<a class="reference internal" href="../../../../../config/core/v3/backoff.proto.html#envoy-v3-api-msg-config-core-v3-backoffstrategy"><span class="std std-ref">config.core.v3.BackoffStrategy</span></a>) Sets the backoff strategy. If not set, the retries are performed without backoff.</p>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-hash-policy">
<dt>hash_policy</dt><dd><p>(<strong>repeated</strong> <a class="reference internal" href="../../../../../type/v3/hash_policy.proto.html#envoy-v3-api-msg-type-v3-hashpolicy"><span class="std std-ref">type.v3.HashPolicy</span></a>) Optional configuration for TCP proxy hash policy. If hash_policy is not set, the hash-based
load balancing algorithms will select a host randomly. Currently the number of hash policies is
limited to 1.</p>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-tunneling-config">
<dt>tunneling_config</dt><dd><p>(<a class="reference internal" href="#envoy-v3-api-msg-extensions-filters-network-tcp-proxy-v3-tcpproxy-tunnelingconfig"><span class="std std-ref">extensions.filters.network.tcp_proxy.v3.TcpProxy.TunnelingConfig</span></a>) If set, this configures tunneling, e.g. configuration options to tunnel TCP payload over
HTTP CONNECT. If this message is absent, the payload will be proxied upstream as per usual.
It is possible to dynamically override this configuration and disable tunneling per connection,
by setting a per-connection filter state object for the key <code class="docutils literal notranslate"><span class="pre">envoy.tcp_proxy.disable_tunneling</span></code>.</p>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-max-downstream-connection-duration">
<dt>max_downstream_connection_duration</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/reference/google.protobuf#duration">Duration</a>) The maximum duration of a connection. The duration is defined as the period since a connection
was established. If not set, there is no max duration. When max_downstream_connection_duration
is reached the connection will be closed. Duration must be at least 1ms.</p>
</dd>
</dl>
<dl id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-access-log-flush-interval">
<dt>access_log_flush_interval</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/reference/google.protobuf#duration">Duration</a>) Note that if both this field and <a class="reference internal" href="#envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-tcpaccesslogoptions-access-log-flush-interval"><span class="std std-ref">access_log_flush_interval</span></a>
are specified, the former (deprecated field) is ignored.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>This field is deprecated in favor of
<a class="reference internal" href="#envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-tcpaccesslogoptions-access-log-flush-interval"><span class="std std-ref">access_log_flush_interval</span></a>.</p>
</div>
</dd>
</dl>
<dl id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-flush-access-log-on-connected">
<dt>flush_access_log_on_connected</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">bool</a>) Note that if both this field and <a class="reference internal" href="#envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-tcpaccesslogoptions-flush-access-log-on-connected"><span class="std std-ref">flush_access_log_on_connected</span></a>
are specified, the former (deprecated field) is ignored.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>This field is deprecated in favor of
<a class="reference internal" href="#envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-tcpaccesslogoptions-flush-access-log-on-connected"><span class="std std-ref">flush_access_log_on_connected</span></a>.</p>
</div>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-access-log-options">
<dt>access_log_options</dt><dd><p>(<a class="reference internal" href="#envoy-v3-api-msg-extensions-filters-network-tcp-proxy-v3-tcpproxy-tcpaccesslogoptions"><span class="std std-ref">extensions.filters.network.tcp_proxy.v3.TcpProxy.TcpAccessLogOptions</span></a>) Additional access log options for TCP Proxy.</p>
</dd>
</dl>
<dl id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-proxy-protocol-tlvs">
<dt>proxy_protocol_tlvs</dt><dd><p>(<strong>repeated</strong> <a class="reference internal" href="../../../../../config/core/v3/proxy_protocol.proto.html#envoy-v3-api-msg-config-core-v3-tlventry"><span class="std std-ref">config.core.v3.TlvEntry</span></a>) If set, the specified PROXY protocol TLVs (Type-Length-Value) will be added to the PROXY protocol
state created by the TCP proxy filter. These TLVs will be sent in the PROXY protocol v2 header
to upstream.</p>
<p>This field only takes effect when the TCP proxy filter is creating new PROXY protocol
state and there is an upstream proxy protocol transport socket configured in the cluster.
If the connection already contains PROXY protocol state (including any TLVs) parsed by a
downstream proxy protocol listener filter, the TLVs specified here are ignored.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To ensure specified TLVs are allowed in the upstream PROXY protocol header, you must also
configure the passthrough TLVs on the upstream proxy protocol transport. See
<a class="reference internal" href="../../../../../config/core/v3/proxy_protocol.proto.html#envoy-v3-api-field-config-core-v3-proxyprotocolconfig-pass-through-tlvs"><span class="std std-ref">core.v3.ProxyProtocolConfig.pass_through_tlvs</span></a>
for details.</p>
</div>
</dd>
</dl>
</section>
<section id="extensions-filters-network-tcp-proxy-v3-tcpproxy-weightedcluster">
<span id="envoy-v3-api-msg-extensions-filters-network-tcp-proxy-v3-tcpproxy-weightedcluster"></span><h2>extensions.filters.network.tcp_proxy.v3.TcpProxy.WeightedCluster<a class="headerlink" href="#extensions-filters-network-tcp-proxy-v3-tcpproxy-weightedcluster" title="Link to this heading"></a></h2>
<p><a class="extlink-repo reference external" href="https://github.com/envoyproxy/envoy/blob/v1.34.3/api/envoy/extensions/filters/network/tcp_proxy/v3/tcp_proxy.proto#L37">[extensions.filters.network.tcp_proxy.v3.TcpProxy.WeightedCluster proto]</a></p>
<p>Allows for specification of multiple upstream clusters along with weights
that indicate the percentage of traffic to be forwarded to each cluster.
The router selects an upstream cluster based on these weights.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;clusters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-weightedcluster-clusters">
<dt>clusters</dt><dd><p>(<strong>repeated</strong> <a class="reference internal" href="#envoy-v3-api-msg-extensions-filters-network-tcp-proxy-v3-tcpproxy-weightedcluster-clusterweight"><span class="std std-ref">extensions.filters.network.tcp_proxy.v3.TcpProxy.WeightedCluster.ClusterWeight</span></a>, <em>REQUIRED</em>) Specifies one or more upstream clusters associated with the route.</p>
</dd>
</dl>
</section>
<section id="extensions-filters-network-tcp-proxy-v3-tcpproxy-weightedcluster-clusterweight">
<span id="envoy-v3-api-msg-extensions-filters-network-tcp-proxy-v3-tcpproxy-weightedcluster-clusterweight"></span><h2>extensions.filters.network.tcp_proxy.v3.TcpProxy.WeightedCluster.ClusterWeight<a class="headerlink" href="#extensions-filters-network-tcp-proxy-v3-tcpproxy-weightedcluster-clusterweight" title="Link to this heading"></a></h2>
<p><a class="extlink-repo reference external" href="https://github.com/envoyproxy/envoy/blob/v1.34.3/api/envoy/extensions/filters/network/tcp_proxy/v3/tcp_proxy.proto#L41">[extensions.filters.network.tcp_proxy.v3.TcpProxy.WeightedCluster.ClusterWeight proto]</a></p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="err">...</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;weight&quot;</span><span class="p">:</span><span class="w"> </span><span class="err">...</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;metadata_match&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-weightedcluster-clusterweight-name">
<dt>name</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">string</a>, <em>REQUIRED</em>) Name of the upstream cluster.</p>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-weightedcluster-clusterweight-weight">
<dt>weight</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">uint32</a>) When a request matches the route, the choice of an upstream cluster is
determined by its weight. The sum of weights across all entries in the
clusters array determines the total weight.</p>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-weightedcluster-clusterweight-metadata-match">
<dt>metadata_match</dt><dd><p>(<a class="reference internal" href="../../../../../config/core/v3/base.proto.html#envoy-v3-api-msg-config-core-v3-metadata"><span class="std std-ref">config.core.v3.Metadata</span></a>) Optional endpoint metadata match criteria used by the subset load balancer. Only endpoints
in the upstream cluster with metadata matching what is set in this field will be considered
for load balancing. Note that this will be merged with what’s provided in
<a class="reference internal" href="#envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-metadata-match"><span class="std std-ref">TcpProxy.metadata_match</span></a>, with values
here taking precedence. The filter name should be specified as <code class="docutils literal notranslate"><span class="pre">envoy.lb</span></code>.</p>
</dd>
</dl>
</section>
<section id="extensions-filters-network-tcp-proxy-v3-tcpproxy-tunnelingconfig">
<span id="envoy-v3-api-msg-extensions-filters-network-tcp-proxy-v3-tcpproxy-tunnelingconfig"></span><h2>extensions.filters.network.tcp_proxy.v3.TcpProxy.TunnelingConfig<a class="headerlink" href="#extensions-filters-network-tcp-proxy-v3-tcpproxy-tunnelingconfig" title="Link to this heading"></a></h2>
<p><a class="extlink-repo reference external" href="https://github.com/envoyproxy/envoy/blob/v1.34.3/api/envoy/extensions/filters/network/tcp_proxy/v3/tcp_proxy.proto#L70">[extensions.filters.network.tcp_proxy.v3.TcpProxy.TunnelingConfig proto]</a></p>
<p>Configuration for tunneling TCP over other transports or application layers.
Tunneling is supported over both HTTP/1.1 and HTTP/2. Upstream protocol is
determined by the cluster configuration.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;hostname&quot;</span><span class="p">:</span><span class="w"> </span><span class="err">...</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;use_post&quot;</span><span class="p">:</span><span class="w"> </span><span class="err">...</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;headers_to_add&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">  </span><span class="nt">&quot;propagate_response_headers&quot;</span><span class="p">:</span><span class="w"> </span><span class="err">...</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;post_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="err">...</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;propagate_response_trailers&quot;</span><span class="p">:</span><span class="w"> </span><span class="err">...</span>
<span class="p">}</span>
</pre></div>
</div>
<dl id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-tunnelingconfig-hostname">
<dt>hostname</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">string</a>, <em>REQUIRED</em>) The hostname to send in the synthesized CONNECT headers to the upstream proxy.
This field evaluates command operators if set, otherwise returns hostname as is.</p>
<p>Example: dynamically set hostname using downstream SNI</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">tunneling_config</span><span class="p">:</span>
<span class="w">  </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;%REQUESTED_SERVER_NAME%:443&quot;</span>
</pre></div>
</div>
<p>Example: dynamically set hostname using dynamic metadata</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">tunneling_config</span><span class="p">:</span>
<span class="w">  </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;%DYNAMIC_METADATA(tunnel:address)%&quot;</span>
</pre></div>
</div>
</dd>
</dl>
<dl id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-tunnelingconfig-use-post">
<dt>use_post</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">bool</a>) Use POST method instead of CONNECT method to tunnel the TCP stream.
The ‘protocol: bytestream’ header is also NOT set for HTTP/2 to comply with the spec.</p>
<p>The upstream proxy is expected to convert POST payload as raw TCP.</p>
</dd>
</dl>
<dl id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-tunnelingconfig-headers-to-add">
<dt>headers_to_add</dt><dd><p>(<strong>repeated</strong> <a class="reference internal" href="../../../../../config/core/v3/base.proto.html#envoy-v3-api-msg-config-core-v3-headervalueoption"><span class="std std-ref">config.core.v3.HeaderValueOption</span></a>) Additional request headers to upstream proxy. This is mainly used to
trigger upstream to convert POST requests back to CONNECT requests.</p>
<p>Neither <code class="docutils literal notranslate"><span class="pre">:-prefixed</span></code> pseudo-headers nor the Host: header can be overridden.</p>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-tunnelingconfig-propagate-response-headers">
<dt>propagate_response_headers</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">bool</a>) Save the response headers to the downstream info filter state for consumption
by the network filters. The filter state key is <code class="docutils literal notranslate"><span class="pre">envoy.tcp_proxy.propagate_response_headers</span></code>.</p>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-tunnelingconfig-post-path">
<dt>post_path</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">string</a>) The path used with POST method. Default path is <code class="docutils literal notranslate"><span class="pre">/</span></code>. If post path is specified and
<a class="reference internal" href="#envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-tunnelingconfig-use-post"><span class="std std-ref">use_post field</span></a>
isn’t true, it will be rejected.</p>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-tunnelingconfig-propagate-response-trailers">
<dt>propagate_response_trailers</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">bool</a>) Save the response trailers to the downstream info filter state for consumption
by the network filters. The filter state key is <code class="docutils literal notranslate"><span class="pre">envoy.tcp_proxy.propagate_response_trailers</span></code>.</p>
</dd>
</dl>
</section>
<section id="extensions-filters-network-tcp-proxy-v3-tcpproxy-ondemand">
<span id="envoy-v3-api-msg-extensions-filters-network-tcp-proxy-v3-tcpproxy-ondemand"></span><h2>extensions.filters.network.tcp_proxy.v3.TcpProxy.OnDemand<a class="headerlink" href="#extensions-filters-network-tcp-proxy-v3-tcpproxy-ondemand" title="Link to this heading"></a></h2>
<p><a class="extlink-repo reference external" href="https://github.com/envoyproxy/envoy/blob/v1.34.3/api/envoy/extensions/filters/network/tcp_proxy/v3/tcp_proxy.proto#L120">[extensions.filters.network.tcp_proxy.v3.TcpProxy.OnDemand proto]</a></p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;odcds_config&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-ondemand-odcds-config">
<dt>odcds_config</dt><dd><p>(<a class="reference internal" href="../../../../../config/core/v3/config_source.proto.html#envoy-v3-api-msg-config-core-v3-configsource"><span class="std std-ref">config.core.v3.ConfigSource</span></a>) An optional configuration for on-demand cluster discovery
service. If not specified, the on-demand cluster discovery will
be disabled. When it’s specified, the filter will pause a request
to an unknown cluster and will begin a cluster discovery
process. When the discovery is finished (successfully or not),
the request will be resumed.</p>
</dd>
</dl>
</section>
<section id="extensions-filters-network-tcp-proxy-v3-tcpproxy-tcpaccesslogoptions">
<span id="envoy-v3-api-msg-extensions-filters-network-tcp-proxy-v3-tcpproxy-tcpaccesslogoptions"></span><h2>extensions.filters.network.tcp_proxy.v3.TcpProxy.TcpAccessLogOptions<a class="headerlink" href="#extensions-filters-network-tcp-proxy-v3-tcpproxy-tcpaccesslogoptions" title="Link to this heading"></a></h2>
<p><a class="extlink-repo reference external" href="https://github.com/envoyproxy/envoy/blob/v1.34.3/api/envoy/extensions/filters/network/tcp_proxy/v3/tcp_proxy.proto#L139">[extensions.filters.network.tcp_proxy.v3.TcpProxy.TcpAccessLogOptions proto]</a></p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;access_log_flush_interval&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;flush_access_log_on_connected&quot;</span><span class="p">:</span><span class="w"> </span><span class="err">...</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-tcpaccesslogoptions-access-log-flush-interval">
<dt>access_log_flush_interval</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/reference/google.protobuf#duration">Duration</a>) The interval to flush access log. The TCP proxy will flush only one access log when the connection
is closed by default. If this field is set, the TCP proxy will flush access log periodically with
the specified interval.
The interval must be at least 1ms.</p>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-tcpaccesslogoptions-flush-access-log-on-connected">
<dt>flush_access_log_on_connected</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">bool</a>) If set to true, access log will be flushed when the TCP proxy has successfully established a
connection with the upstream. If the connection failed, the access log will not be flushed.</p>
</dd>
</dl>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../../sni_dynamic_forward_proxy/v3/sni_dynamic_forward_proxy.proto.html" class="btn btn-neutral float-left" title="SNI dynamic forward proxy (proto)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../thrift_proxy/v3/route.proto.html" class="btn btn-neutral float-right" title="Thrift Proxy Route Configuration (proto)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2025, Envoy Project Authors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>